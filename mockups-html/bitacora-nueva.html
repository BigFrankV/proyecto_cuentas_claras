<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Nueva Entrada de Bit√°cora - Cuentas Claras</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Tokens / overrides -->
    <link href="assets/css/style.css" rel="stylesheet">
    <style>
      /* Mobile-first Styles */
      .nav-sidebar .nav-item .nav-link { color: rgba(255,255,255,0.8); }
      .nav-sidebar .nav-item .nav-link:hover { color: #fff; background-color: rgba(255,255,255,0.1); }
      .nav-sidebar .nav-item .nav-link.active { 
        color: #fff; 
        background: rgba(253,93,20,0.2);
        border-left: 3px solid var(--color-accent);
      }
      .nav-sidebar .nav-item .nav-link.active .material-icons { color: var(--color-accent); }
      
      .sidebar {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        z-index: 1000;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        width: 280px;
      }
      
      .sidebar.show {
        transform: translateX(0);
      }
      
      .sidebar-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 999;
        background-color: rgba(0,0,0,0.5);
        display: none;
      }
      
      .sidebar-backdrop.show {
        display: block;
      }
      
      @media (min-width: 992px) {
        .sidebar {
          transform: translateX(0);
        }
        
        .main-content {
          margin-left: 280px;
        }
        
        .toggle-sidebar {
          display: none;
        }
      }
      
      .avatar {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--color-primary);
        color: #fff;
        font-weight: bold;
        border-radius: 50%;
      }
      
      /* Form styles */
      .form-card {
        background-color: #fff;
        border-radius: var(--radius);
        padding: 2rem;
        box-shadow: var(--shadow-sm);
        border: 1px solid #e9ecef;
        margin-bottom: 1.5rem;
      }
      
      .form-section {
        margin-bottom: 2rem;
        padding-bottom: 2rem;
        border-bottom: 1px solid #f8f9fa;
      }
      
      .form-section:last-child {
        margin-bottom: 0;
        padding-bottom: 0;
        border-bottom: none;
      }
      
      .section-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #212529;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
      }
      
      .section-title .material-icons {
        margin-right: 0.5rem;
        color: var(--color-primary);
      }
      
      /* Activity type cards */
      .activity-type-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
      }
      
      .activity-type-card {
        border: 2px solid #e9ecef;
        border-radius: var(--radius);
        padding: 1.5rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background-color: #fff;
        position: relative;
        overflow: hidden;
      }
      
      .activity-type-card:hover {
        border-color: var(--color-primary);
        box-shadow: var(--shadow-md);
        transform: translateY(-2px);
      }
      
      .activity-type-card.selected {
        border-color: var(--color-primary);
        background-color: #FFF8F5;
        box-shadow: var(--shadow-md);
      }
      
      .activity-type-card.selected::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background-color: var(--color-primary);
      }
      
      .activity-type-icon {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 1rem;
        font-size: 1.5rem;
        color: white;
      }
      
      .activity-type-card.system .activity-type-icon {
        background-color: #17a2b8;
      }
      
      .activity-type-card.user .activity-type-icon {
        background-color: #28a745;
      }
      
      .activity-type-card.security .activity-type-icon {
        background-color: #dc3545;
      }
      
      .activity-type-card.maintenance .activity-type-icon {
        background-color: #ffc107;
        color: #212529;
      }
      
      .activity-type-card.admin .activity-type-icon {
        background-color: #6f42c1;
      }
      
      .activity-type-card.financial .activity-type-icon {
        background-color: #009688;
      }
      
      .activity-type-title {
        font-weight: 600;
        color: #212529;
        margin-bottom: 0.5rem;
      }
      
      .activity-type-description {
        color: #6c757d;
        font-size: 0.875rem;
        line-height: 1.4;
      }
      
      /* Priority selection */
      .priority-options {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 1rem;
      }
      
      .priority-option {
        border: 2px solid #e9ecef;
        border-radius: var(--radius);
        padding: 1rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        background-color: #fff;
      }
      
      .priority-option:hover {
        border-color: #adb5bd;
        box-shadow: var(--shadow-sm);
      }
      
      .priority-option.selected {
        box-shadow: var(--shadow-md);
      }
      
      .priority-option.low.selected {
        border-color: #17a2b8;
        background-color: #E3F2FD;
      }
      
      .priority-option.normal.selected {
        border-color: #28a745;
        background-color: #E8F5E9;
      }
      
      .priority-option.high.selected {
        border-color: #ffc107;
        background-color: #FFF8E1;
      }
      
      .priority-option.critical.selected {
        border-color: #dc3545;
        background-color: #FFEBEE;
      }
      
      .priority-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }
      
      .priority-option.low .priority-icon {
        color: #17a2b8;
      }
      
      .priority-option.normal .priority-icon {
        color: #28a745;
      }
      
      .priority-option.high .priority-icon {
        color: #ffc107;
      }
      
      .priority-option.critical .priority-icon {
        color: #dc3545;
      }
      
      .priority-title {
        font-weight: 600;
        color: #212529;
        margin-bottom: 0.25rem;
      }
      
      .priority-description {
        color: #6c757d;
        font-size: 0.75rem;
      }
      
      /* Rich text editor simulation */
      .editor-toolbar {
        border: 1px solid #e9ecef;
        border-bottom: none;
        background-color: #f8f9fa;
        padding: 0.5rem;
        border-radius: var(--radius) var(--radius) 0 0;
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }
      
      .editor-btn {
        border: none;
        background: none;
        padding: 0.375rem 0.5rem;
        border-radius: 0.25rem;
        color: #6c757d;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      
      .editor-btn:hover {
        background-color: #e9ecef;
        color: #212529;
      }
      
      .editor-btn.active {
        background-color: var(--color-primary);
        color: white;
      }
      
      .editor-content {
        border: 1px solid #e9ecef;
        border-radius: 0 0 var(--radius) var(--radius);
        min-height: 150px;
        padding: 1rem;
        font-family: inherit;
        font-size: 0.875rem;
        line-height: 1.5;
        resize: vertical;
      }
      
      .editor-content:focus {
        outline: none;
        border-color: var(--color-primary);
        box-shadow: 0 0 0 0.2rem rgba(253, 93, 20, 0.25);
      }
      
      /* Tags input */
      .tags-container {
        border: 1px solid #ced4da;
        border-radius: var(--radius);
        padding: 0.5rem;
        min-height: 50px;
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        background-color: #fff;
        cursor: text;
      }
      
      .tags-container:focus-within {
        border-color: var(--color-primary);
        box-shadow: 0 0 0 0.2rem rgba(253, 93, 20, 0.25);
      }
      
      .tag {
        background-color: var(--color-primary);
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }
      
      .tag .remove-tag {
        cursor: pointer;
        opacity: 0.7;
        transition: opacity 0.2s ease;
      }
      
      .tag .remove-tag:hover {
        opacity: 1;
      }
      
      .tag-input {
        border: none;
        outline: none;
        flex: 1;
        min-width: 100px;
        padding: 0.25rem 0;
        background: transparent;
      }
      
      /* File upload */
      .file-upload-area {
        border: 2px dashed #e9ecef;
        border-radius: var(--radius);
        padding: 2rem;
        text-align: center;
        background-color: #fafafa;
        cursor: pointer;
        transition: all 0.3s ease;
      }
      
      .file-upload-area:hover {
        border-color: var(--color-primary);
        background-color: #fff8f5;
      }
      
      .file-upload-area.dragover {
        border-color: var(--color-primary);
        background-color: #fff8f5;
        transform: scale(1.02);
      }
      
      .upload-icon {
        font-size: 3rem;
        color: #6c757d;
        margin-bottom: 1rem;
      }
      
      .upload-text {
        color: #6c757d;
        margin-bottom: 0.5rem;
      }
      
      .upload-hint {
        color: #adb5bd;
        font-size: 0.875rem;
      }
      
      .file-list {
        margin-top: 1rem;
      }
      
      .file-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0.75rem;
        border: 1px solid #e9ecef;
        border-radius: var(--radius);
        margin-bottom: 0.5rem;
        background-color: #fff;
      }
      
      .file-info {
        display: flex;
        align-items: center;
        flex: 1;
      }
      
      .file-icon {
        width: 40px;
        height: 40px;
        border-radius: var(--radius);
        background-color: var(--color-primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
      }
      
      .file-details {
        flex: 1;
      }
      
      .file-name {
        font-weight: 500;
        color: #212529;
        margin-bottom: 0.25rem;
      }
      
      .file-size {
        color: #6c757d;
        font-size: 0.875rem;
      }
      
      .file-actions {
        display: flex;
        gap: 0.5rem;
      }
      
      .file-action {
        border: none;
        background: none;
        color: #6c757d;
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 0.25rem;
        transition: all 0.2s ease;
      }
      
      .file-action:hover {
        color: #212529;
        background-color: #f8f9fa;
      }
      
      .file-action.remove:hover {
        color: #dc3545;
      }
      
      /* Action buttons */
      .action-btn {
        border: none;
        border-radius: var(--radius);
        padding: 0.75rem 1.5rem;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        text-decoration: none;
        gap: 0.5rem;
      }
      
      .action-btn .material-icons {
        font-size: 1.1rem;
      }
      
      .action-btn.primary {
        background-color: var(--color-primary);
        color: white;
      }
      
      .action-btn.primary:hover {
        background-color: #e85a14;
        color: white;
      }
      
      .action-btn.success {
        background-color: #28a745;
        color: white;
      }
      
      .action-btn.success:hover {
        background-color: #218838;
        color: white;
      }
      
      .action-btn.outline {
        background-color: transparent;
        color: var(--color-primary);
        border: 1px solid var(--color-primary);
      }
      
      .action-btn.outline:hover {
        background-color: var(--color-primary);
        color: white;
      }
      
      .action-btn.secondary {
        background-color: #6c757d;
        color: white;
      }
      
      .action-btn.secondary:hover {
        background-color: #545b62;
        color: white;
      }
      
      /* Form actions */
      .form-actions {
        background-color: #f8f9fa;
        padding: 1.5rem 2rem;
        border-radius: 0 0 var(--radius) var(--radius);
        border-top: 1px solid #e9ecef;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }
      
      .form-actions .btn-group {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      
      /* Activity preview */
      .activity-preview {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-top: 1rem;
      }
      
      .preview-header {
        display: flex;
        justify-content: between;
        align-items: start;
        margin-bottom: 1rem;
        flex-wrap: wrap;
        gap: 1rem;
      }
      
      .preview-badges {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
      }
      
      .preview-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 500;
      }
      
      .preview-badge.system {
        background-color: #E3F2FD;
        color: #1565C0;
      }
      
      .preview-badge.user {
        background-color: #E8F5E9;
        color: #2E7D32;
      }
      
      .preview-badge.security {
        background-color: #FFEBEE;
        color: #C62828;
      }
      
      .preview-badge.maintenance {
        background-color: #FFF8E1;
        color: #F57F17;
      }
      
      .preview-badge.admin {
        background-color: #F3E5F5;
        color: #7B1FA2;
      }
      
      .preview-badge.financial {
        background-color: #E0F2F1;
        color: #00695C;
      }
      
      .preview-badge.low {
        background-color: #d1ecf1;
        color: #0c5460;
      }
      
      .preview-badge.normal {
        background-color: #d4edda;
        color: #155724;
      }
      
      .preview-badge.high {
        background-color: #fff3cd;
        color: #856404;
      }
      
      .preview-badge.critical {
        background-color: #f8d7da;
        color: #721c24;
      }
      
      .preview-content {
        color: #495057;
        line-height: 1.6;
        margin-bottom: 1rem;
      }
      
      .preview-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 1rem;
        font-size: 0.875rem;
        color: #6c757d;
      }
      
      .preview-meta-item {
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }
      
      /* Responsive adjustments */
      @media (max-width: 768px) {
        .form-card {
          padding: 1rem;
        }
        
        .activity-type-grid {
          grid-template-columns: 1fr;
        }
        
        .priority-options {
          grid-template-columns: repeat(2, 1fr);
        }
        
        .form-actions {
          padding: 1rem;
          flex-direction: column;
          align-items: stretch;
        }
        
        .form-actions .btn-group {
          justify-content: center;
        }
      }
    </style>
  </head>
  <body>
    <div class="d-flex">
      <!-- Sidebar -->
      <section class="supermenu-cuentasclaras">
             <!-- Sidebar -->
      <div class="sidebar d-flex flex-column flex-shrink-0 p-3 text-white bg-dark" id="sidebar" style="background: linear-gradient(180deg, var(--color-primary) 0%, #071a38 100%) !important;">
        <a href="dashboard.html" class="d-flex align-items-center text-white text-decoration-none mb-4">
          <span class="material-icons me-2" style="font-size: 32px;">apartment</span>
          <span class="fs-4">Cuentas Claras</span>
        </a>
        
        <div class="d-flex align-items-center mb-3 px-2">
          <div class="avatar me-2" style="background-color: var(--color-accent);">PC</div>
          <div>
            <span class="d-block text-white">Patricia Contreras</span>
            <span class="small text-white-50">Administradora</span>
          </div>
        </div>
        
        <hr>
        
        <!-- Navegaci√≥n principal -->
        <div class="nav-sections" style="flex: 1; overflow-y: auto;">
          
          <!-- DASHBOARD -->
          <div class="nav-section-header">Dashboard</div>
          <ul class="nav nav-sidebar flex-column">
            <li class="nav-item">
              <a href="dashboard.html" class="nav-link">
                <span class="material-icons align-middle me-2">dashboard</span>
                <span>Panel Principal</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="reportes-dashboard.html" class="nav-link">
                <span class="material-icons align-middle me-2">bar_chart</span>
                <span>Reportes</span>
              </a>
            </li>
          </ul>

          <!-- COMUNIDADES Y ESTRUCTURA -->
          <div class="nav-section-header">Estructura</div>
          <ul class="nav nav-sidebar flex-column">
            <li class="nav-item">
              <a href="comunidades-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">domain</span>
                <span>Comunidades</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="edificios-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">business</span>
                <span>Edificios</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="torres-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">location_city</span>
                <span>Torres</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="unidades-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">apartment</span>
                <span>Unidades</span>
              </a>
            </li>
          </ul>

          <!-- PERSONAS Y MEMBRES√çAS -->
          <div class="nav-section-header">Residentes</div>
          <ul class="nav nav-sidebar flex-column">
            <li class="nav-item">
              <a href="personas-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">people</span>
                <span>Personas</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="membresias-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">card_membership</span>
                <span>Membres√≠as</span>
              </a>
            </li>
          </ul>

          <!-- FINANZAS -->
          <div class="nav-section-header">Finanzas</div>
          <ul class="nav nav-sidebar flex-column">
            <li class="nav-item">
              <a href="emisiones-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">receipt_long</span>
                <span>Emisiones</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="cargos-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">assignment</span>
                <span>Cargos</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="pagos-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">payments</span>
                <span>Pagos</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="conciliaciones-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">account_balance</span>
                <span>Conciliaciones</span>
              </a>
            </li>
          </ul>

          <!-- GASTOS Y COMPRAS -->
          <div class="nav-section-header">Gastos</div>
          <ul class="nav nav-sidebar flex-column">
            <li class="nav-item">
              <a href="gastos-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">shopping_cart</span>
                <span>Gastos</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="categorias-gasto-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">category</span>
                <span>Categor√≠as</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="centros-costo-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">account_balance_wallet</span>
                <span>Centros de Costo</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="proveedores-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">store</span>
                <span>Proveedores</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="documentos-compra-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">inventory</span>
                <span>Compras</span>
              </a>
            </li>
          </ul>

          <!-- MEDIDORES Y SERVICIOS -->
          <div class="nav-section-header">Servicios</div>
          <ul class="nav nav-sidebar flex-column">
            <li class="nav-item">
              <a href="medidores-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">speed</span>
                <span>Medidores</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="lecturas-medidor.html" class="nav-link">
                <span class="material-icons align-middle me-2">visibility</span>
                <span>Lecturas</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="consumos-medidor.html" class="nav-link">
                <span class="material-icons align-middle me-2">water_drop</span>
                <span>Consumos</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="tarifas-consumo-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">price_change</span>
                <span>Tarifas</span>
              </a>
            </li>
          </ul>

          <!-- AMENIDADES Y RESERVAS -->
          <div class="nav-section-header">Amenidades</div>
          <ul class="nav nav-sidebar flex-column">
            <li class="nav-item">
              <a href="amenidades-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">pool</span>
                <span>Amenidades</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="reservas-amenidad.html" class="nav-link">
                <span class="material-icons align-middle me-2">event_available</span>
                <span>Reservas</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="calendario-reservas.html" class="nav-link">
                <span class="material-icons align-middle me-2">calendar_month</span>
                <span>Calendario</span>
              </a>
            </li>
          </ul>

          <!-- MULTAS Y SANCIONES -->
          <div class="nav-section-header">Sanciones</div>
          <ul class="nav nav-sidebar flex-column">
            <li class="nav-item">
              <a href="multas-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">gavel</span>
                <span>Multas</span>
              </a>
            </li>
          </ul>

          <!-- SOPORTE Y COMUNICACI√ìN -->
          <div class="nav-section-header">Comunicaci√≥n</div>
          <ul class="nav nav-sidebar flex-column">
            <li class="nav-item">
              <a href="tickets-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">support_agent</span>
                <span>Tickets</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="notificaciones-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">notifications</span>
                <span>Notificaciones</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="documentos-listado.html" class="nav-link">
                <span class="material-icons align-middle me-2">folder</span>
                <span>Documentos</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="bitacora-listado.html" class="nav-link active">
                <span class="material-icons align-middle me-2">history</span>
                <span>Bit√°cora</span>
              </a>
            </li>
          </ul>

          <!-- UTILIDADES -->
          <div class="nav-section-header">Utilidades</div>
          <ul class="nav nav-sidebar flex-column">
            <li class="nav-item">
              <a href="util-uf.html" class="nav-link">
                <span class="material-icons align-middle me-2">trending_up</span>
                <span>Valor UF</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="util-utm.html" class="nav-link">
                <span class="material-icons align-middle me-2">calculate</span>
                <span>Valor UTM</span>
              </a>
            </li>
            <li class="nav-item">
              <a href="util-rut.html" class="nav-link">
                <span class="material-icons align-middle me-2">verified_user</span>
                <span>Validador RUT</span>
              </a>
            </li>
          </ul>
        </div>
        
        <hr>
        
        <div class="dropdown">
          <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown">
            <span class="material-icons me-2">settings</span>
            <span>Configuraci√≥n</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" href="profile.html">Mi Perfil</a></li>
            <li><a class="dropdown-item" href="comunidad-parametros.html">Par√°metros</a></li>
            <li><a class="dropdown-item" href="#">Preferencias</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="login.html">Cerrar Sesi√≥n</a></li>
          </ul>
        </div>
      </div>
      </section>
      
      <!-- Sidebar backdrop for mobile -->
      <div class="sidebar-backdrop" onclick="toggleSidebar()"></div>
      
      <!-- Contenido principal -->
      <div class="main-content flex-grow-1 bg-light">
        <!-- Header con b√∫squeda y notificaciones -->
        <header class="bg-white border-bottom shadow-sm p-3">
          <div class="container-fluid">
            <div class="row align-items-center">
              <div class="col-lg-6">
                <button class="btn toggle-sidebar d-lg-none me-2" onclick="toggleSidebar()">
                  <span class="material-icons">menu</span>
                </button>
                <h5 class="mb-0">Nueva Entrada de Bit√°cora</h5>
                <small class="text-muted">Registrar actividad manual en el sistema</small>
              </div>
              
              <div class="col-lg-6">
                <div class="d-flex justify-content-end align-items-center">
                  <div class="me-3">
                    <button class="btn position-relative p-0" type="button" data-bs-toggle="dropdown">
                      <span class="material-icons">notifications</span>
                      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        3
                      </span>
                    </button>
                  </div>
                  
                  <div class="dropdown">
                    <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle" id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
                      <div class="avatar me-2" style="background-color: var(--color-accent);">PC</div>
                      <div class="d-none d-sm-block">
                        <div class="fw-bold">Patricia Contreras</div>
                        <small class="text-muted">Administradora</small>
                      </div>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                      <li><a class="dropdown-item" href="profile.html">Mi Perfil</a></li>
                      <li><a class="dropdown-item" href="#">Configuraci√≥n</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item text-danger" href="login.html">Cerrar Sesi√≥n</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </header>

        <!-- Contenido -->
        <main class="container-fluid p-4">
          <form id="bitacoraForm">
            <div class="form-card">
              <!-- Informaci√≥n b√°sica -->
              <div class="form-section">
                <div class="section-title">
                  <span class="material-icons">info</span>
                  Informaci√≥n B√°sica
                </div>
                
                <div class="row">
                  <div class="col-md-8">
                    <label for="activityTitle" class="form-label">T√≠tulo de la Actividad *</label>
                    <input type="text" class="form-control" id="activityTitle" name="activityTitle" 
                           placeholder="Ej: Reuni√≥n extraordinaria de administraci√≥n" required>
                  </div>
                  <div class="col-md-4">
                    <label for="activityDate" class="form-label">Fecha y Hora *</label>
                    <input type="datetime-local" class="form-control" id="activityDate" name="activityDate" required>
                  </div>
                </div>
              </div>

              <!-- Tipo de actividad -->
              <div class="form-section">
                <div class="section-title">
                  <span class="material-icons">category</span>
                  Tipo de Actividad
                </div>
                
                <div class="activity-type-grid">
                  <div class="activity-type-card system" data-type="system">
                    <div class="activity-type-icon">
                      <span class="material-icons">computer</span>
                    </div>
                    <div class="activity-type-title">Sistema</div>
                    <div class="activity-type-description">Eventos autom√°ticos del sistema, backups, actualizaciones</div>
                  </div>
                  
                  <div class="activity-type-card user" data-type="user">
                    <div class="activity-type-icon">
                      <span class="material-icons">person</span>
                    </div>
                    <div class="activity-type-title">Usuario</div>
                    <div class="activity-type-description">Acciones realizadas por usuarios del sistema</div>
                  </div>
                  
                  <div class="activity-type-card security" data-type="security">
                    <div class="activity-type-icon">
                      <span class="material-icons">security</span>
                    </div>
                    <div class="activity-type-title">Seguridad</div>
                    <div class="activity-type-description">Eventos de seguridad, alertas, accesos</div>
                  </div>
                  
                  <div class="activity-type-card maintenance" data-type="maintenance">
                    <div class="activity-type-icon">
                      <span class="material-icons">build</span>
                    </div>
                    <div class="activity-type-title">Mantenimiento</div>
                    <div class="activity-type-description">Trabajos de mantenimiento, reparaciones</div>
                  </div>
                  
                  <div class="activity-type-card admin" data-type="admin">
                    <div class="activity-type-icon">
                      <span class="material-icons">admin_panel_settings</span>
                    </div>
                    <div class="activity-type-title">Administraci√≥n</div>
                    <div class="activity-type-description">Gestiones administrativas, reuniones</div>
                  </div>
                  
                  <div class="activity-type-card financial" data-type="financial">
                    <div class="activity-type-icon">
                      <span class="material-icons">account_balance</span>
                    </div>
                    <div class="activity-type-title">Financiero</div>
                    <div class="activity-type-description">Pagos, ingresos, gesti√≥n financiera</div>
                  </div>
                </div>
                
                <input type="hidden" id="selectedActivityType" name="activityType" required>
              </div>

              <!-- Prioridad -->
              <div class="form-section">
                <div class="section-title">
                  <span class="material-icons">priority_high</span>
                  Nivel de Prioridad
                </div>
                
                <div class="priority-options">
                  <div class="priority-option low" data-priority="low">
                    <div class="priority-icon">
                      <span class="material-icons">expand_more</span>
                    </div>
                    <div class="priority-title">Baja</div>
                    <div class="priority-description">Informaci√≥n general</div>
                  </div>
                  
                  <div class="priority-option normal selected" data-priority="normal">
                    <div class="priority-icon">
                      <span class="material-icons">remove</span>
                    </div>
                    <div class="priority-title">Normal</div>
                    <div class="priority-description">Actividad est√°ndar</div>
                  </div>
                  
                  <div class="priority-option high" data-priority="high">
                    <div class="priority-icon">
                      <span class="material-icons">expand_less</span>
                    </div>
                    <div class="priority-title">Alta</div>
                    <div class="priority-description">Requiere atenci√≥n</div>
                  </div>
                  
                  <div class="priority-option critical" data-priority="critical">
                    <div class="priority-icon">
                      <span class="material-icons">warning</span>
                    </div>
                    <div class="priority-title">Cr√≠tica</div>
                    <div class="priority-description">Atenci√≥n inmediata</div>
                  </div>
                </div>
                
                <input type="hidden" id="selectedPriority" name="priority" value="normal">
              </div>

              <!-- Descripci√≥n detallada -->
              <div class="form-section">
                <div class="section-title">
                  <span class="material-icons">description</span>
                  Descripci√≥n Detallada
                </div>
                
                <label for="activityDescription" class="form-label">Descripci√≥n de la Actividad *</label>
                <div class="editor-toolbar">
                  <button type="button" class="editor-btn" onclick="formatText('bold')">
                    <span class="material-icons">format_bold</span>
                  </button>
                  <button type="button" class="editor-btn" onclick="formatText('italic')">
                    <span class="material-icons">format_italic</span>
                  </button>
                  <button type="button" class="editor-btn" onclick="formatText('underline')">
                    <span class="material-icons">format_underlined</span>
                  </button>
                  <div style="width: 1px; height: 20px; background-color: #e9ecef; margin: 0 0.5rem;"></div>
                  <button type="button" class="editor-btn" onclick="formatText('insertUnorderedList')">
                    <span class="material-icons">format_list_bulleted</span>
                  </button>
                  <button type="button" class="editor-btn" onclick="formatText('insertOrderedList')">
                    <span class="material-icons">format_list_numbered</span>
                  </button>
                </div>
                <div class="editor-content" contenteditable="true" id="activityDescription" 
                     placeholder="Describe detalladamente la actividad registrada..."></div>
                <small class="form-text text-muted mt-2">
                  Proporciona todos los detalles relevantes de la actividad para facilitar el seguimiento y auditor√≠a.
                </small>
              </div>

              <!-- Informaci√≥n adicional -->
              <div class="form-section">
                <div class="section-title">
                  <span class="material-icons">info_outline</span>
                  Informaci√≥n Adicional
                </div>
                
                <div class="row">
                  <div class="col-md-6">
                    <label for="relatedModule" class="form-label">M√≥dulo Relacionado</label>
                    <select class="form-select" id="relatedModule" name="relatedModule">
                      <option value="">Seleccionar m√≥dulo</option>
                      <option value="tickets">Tickets de Soporte</option>
                      <option value="notifications">Notificaciones</option>
                      <option value="documents">Documentos</option>
                      <option value="users">Gesti√≥n de Usuarios</option>
                      <option value="units">Unidades</option>
                      <option value="communities">Comunidades</option>
                      <option value="payments">Pagos y Finanzas</option>
                      <option value="maintenance">Mantenimiento</option>
                      <option value="security">Seguridad</option>
                      <option value="reports">Reportes</option>
                    </select>
                  </div>
                  <div class="col-md-6">
                    <label for="relatedUser" class="form-label">Usuario Relacionado</label>
                    <select class="form-select" id="relatedUser" name="relatedUser">
                      <option value="">Seleccionar usuario</option>
                      <option value="patricia">Patricia Contreras (Administradora)</option>
                      <option value="carlos">Carlos Mendoza (Conserje)</option>
                      <option value="ana">Ana L√≥pez (Contadora)</option>
                      <option value="system">Sistema Autom√°tico</option>
                    </select>
                  </div>
                </div>
                
                <div class="row mt-3">
                  <div class="col-md-6">
                    <label for="activityLocation" class="form-label">Ubicaci√≥n</label>
                    <input type="text" class="form-control" id="activityLocation" name="activityLocation" 
                           placeholder="Ej: Oficina de administraci√≥n, Estacionamiento, Torre A">
                  </div>
                  <div class="col-md-6">
                    <label for="affectedUnit" class="form-label">Unidad Afectada</label>
                    <input type="text" class="form-control" id="affectedUnit" name="affectedUnit" 
                           placeholder="Ej: Depto 301, Torre Norte">
                  </div>
                </div>
              </div>

              <!-- Etiquetas -->
              <div class="form-section">
                <div class="section-title">
                  <span class="material-icons">local_offer</span>
                  Etiquetas
                </div>
                
                <label for="activityTags" class="form-label">Etiquetas (separadas por Enter)</label>
                <div class="tags-container" onclick="focusTagInput()">
                  <input type="text" class="tag-input" id="tagInput" placeholder="Agregar etiqueta..." 
                         onkeydown="handleTagInput(event)">
                </div>
                <small class="form-text text-muted">
                  Las etiquetas ayudan a categorizar y buscar actividades. Ej: urgente, revisi√≥n, mantenimiento
                </small>
              </div>

              <!-- Adjuntos -->
              <div class="form-section">
                <div class="section-title">
                  <span class="material-icons">attach_file</span>
                  Archivos Adjuntos
                </div>
                
                <div class="file-upload-area" onclick="document.getElementById('fileInput').click()" 
                     ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                  <div class="upload-icon">
                    <span class="material-icons">cloud_upload</span>
                  </div>
                  <div class="upload-text">
                    <strong>Arrastra archivos aqu√≠</strong> o haz clic para seleccionar
                  </div>
                  <div class="upload-hint">
                    Formatos soportados: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG (m√°x. 10MB por archivo)
                  </div>
                </div>
                
                <input type="file" id="fileInput" multiple accept=".pdf,.doc,.docx,.xls,.xlsx,.jpg,.jpeg,.png" 
                       style="display: none;" onchange="handleFileSelect(event)">
                
                <div class="file-list" id="fileList"></div>
              </div>
            </div>

            <!-- Vista previa -->
            <div class="form-card">
              <div class="section-title">
                <span class="material-icons">visibility</span>
                Vista Previa
              </div>
              
              <div class="activity-preview" id="activityPreview">
                <div class="preview-header">
                  <div>
                    <h6 class="mb-1" id="previewTitle">T√≠tulo de la actividad</h6>
                    <small class="text-muted" id="previewDate">Fecha y hora</small>
                  </div>
                </div>
                
                <div class="preview-badges" id="previewBadges">
                  <span class="preview-badge normal">Normal</span>
                </div>
                
                <div class="preview-content" id="previewContent">
                  Descripci√≥n de la actividad aparecer√° aqu√≠...
                </div>
                
                <div class="preview-meta" id="previewMeta">
                  <div class="preview-meta-item">
                    <span class="material-icons">person</span>
                    Patricia Contreras
                  </div>
                  <div class="preview-meta-item">
                    <span class="material-icons">schedule</span>
                    <span id="previewTimestamp">Ahora</span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Acciones del formulario -->
            <div class="form-actions">
              <div class="d-flex align-items-center">
                <span class="material-icons text-muted me-2">info</span>
                <small class="text-muted">Los campos marcados con * son obligatorios</small>
              </div>
              
              <div class="btn-group">
                <button type="button" class="action-btn secondary" onclick="saveDraft()">
                  <span class="material-icons">save</span>
                  Guardar Borrador
                </button>
                <a href="bitacora-listado.html" class="action-btn outline">
                  <span class="material-icons">close</span>
                  Cancelar
                </a>
                <button type="submit" class="action-btn primary">
                  <span class="material-icons">add</span>
                  Registrar Actividad
                </button>
              </div>
            </div>
          </form>
        </main>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <script src="assets/js/script.js"></script>
    <script>
      function toggleSidebar() {
        const sidebar = document.querySelector('.sidebar');
        const backdrop = document.querySelector('.sidebar-backdrop');
        
        sidebar.classList.toggle('show');
        backdrop.classList.toggle('show');
      }

      // Initialize datetime input with current date
      document.addEventListener('DOMContentLoaded', function() {
        const now = new Date();
        const timeString = now.toISOString().slice(0, 16);
        document.getElementById('activityDate').value = timeString;
        
        updatePreview();
      });

      // Activity type selection
      document.querySelectorAll('.activity-type-card').forEach(card => {
        card.addEventListener('click', function() {
          // Remove selection from all cards
          document.querySelectorAll('.activity-type-card').forEach(c => c.classList.remove('selected'));
          
          // Select this card
          this.classList.add('selected');
          
          // Update hidden input
          const type = this.dataset.type;
          document.getElementById('selectedActivityType').value = type;
          
          updatePreview();
        });
      });

      // Priority selection
      document.querySelectorAll('.priority-option').forEach(option => {
        option.addEventListener('click', function() {
          // Remove selection from all options
          document.querySelectorAll('.priority-option').forEach(o => o.classList.remove('selected'));
          
          // Select this option
          this.classList.add('selected');
          
          // Update hidden input
          const priority = this.dataset.priority;
          document.getElementById('selectedPriority').value = priority;
          
          updatePreview();
        });
      });

      // Rich text editor functions
      function formatText(command) {
        document.execCommand(command, false, null);
        updatePreview();
      }

      // Content change listeners
      document.getElementById('activityTitle').addEventListener('input', updatePreview);
      document.getElementById('activityDate').addEventListener('change', updatePreview);
      document.getElementById('activityDescription').addEventListener('input', updatePreview);

      // Tags functionality
      let tags = [];

      function focusTagInput() {
        document.getElementById('tagInput').focus();
      }

      function handleTagInput(event) {
        if (event.key === 'Enter' && event.target.value.trim()) {
          event.preventDefault();
          addTag(event.target.value.trim());
          event.target.value = '';
        } else if (event.key === 'Backspace' && !event.target.value && tags.length > 0) {
          removeTag(tags.length - 1);
        }
      }

      function addTag(tagText) {
        if (!tags.includes(tagText)) {
          tags.push(tagText);
          renderTags();
          updatePreview();
        }
      }

      function removeTag(index) {
        tags.splice(index, 1);
        renderTags();
        updatePreview();
      }

      function renderTags() {
        const container = document.querySelector('.tags-container');
        const input = document.getElementById('tagInput');
        
        // Clear existing tags
        const existingTags = container.querySelectorAll('.tag');
        existingTags.forEach(tag => tag.remove());
        
        // Add tags
        tags.forEach((tag, index) => {
          const tagElement = document.createElement('span');
          tagElement.className = 'tag';
          tagElement.innerHTML = `
            ${tag}
            <span class="material-icons remove-tag" onclick="removeTag(${index})">close</span>
          `;
          container.insertBefore(tagElement, input);
        });
      }

      // File upload functionality
      let uploadedFiles = [];

      function handleDragOver(event) {
        event.preventDefault();
        event.currentTarget.classList.add('dragover');
      }

      function handleDragLeave(event) {
        event.currentTarget.classList.remove('dragover');
      }

      function handleFileDrop(event) {
        event.preventDefault();
        event.currentTarget.classList.remove('dragover');
        
        const files = Array.from(event.dataTransfer.files);
        addFiles(files);
      }

      function handleFileSelect(event) {
        const files = Array.from(event.target.files);
        addFiles(files);
      }

      function addFiles(files) {
        files.forEach(file => {
          if (file.size <= 10 * 1024 * 1024) { // 10MB limit
            uploadedFiles.push(file);
          } else {
            alert(`El archivo ${file.name} es demasiado grande. M√°ximo 10MB.`);
          }
        });
        
        renderFileList();
      }

      function removeFile(index) {
        uploadedFiles.splice(index, 1);
        renderFileList();
      }

      function renderFileList() {
        const fileList = document.getElementById('fileList');
        
        if (uploadedFiles.length === 0) {
          fileList.innerHTML = '';
          return;
        }
        
        fileList.innerHTML = uploadedFiles.map((file, index) => `
          <div class="file-item">
            <div class="file-info">
              <div class="file-icon">
                <span class="material-icons">${getFileIcon(file.name)}</span>
              </div>
              <div class="file-details">
                <div class="file-name">${file.name}</div>
                <div class="file-size">${formatFileSize(file.size)}</div>
              </div>
            </div>
            <div class="file-actions">
              <button type="button" class="file-action remove" onclick="removeFile(${index})">
                <span class="material-icons">delete</span>
              </button>
            </div>
          </div>
        `).join('');
      }

      function getFileIcon(filename) {
        const ext = filename.split('.').pop().toLowerCase();
        switch (ext) {
          case 'pdf': return 'picture_as_pdf';
          case 'doc':
          case 'docx': return 'description';
          case 'xls':
          case 'xlsx': return 'table_chart';
          case 'jpg':
          case 'jpeg':
          case 'png': return 'image';
          default: return 'attach_file';
        }
      }

      function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
      }

      // Preview update function
      function updatePreview() {
        const title = document.getElementById('activityTitle').value || 'T√≠tulo de la actividad';
        const date = document.getElementById('activityDate').value;
        const description = document.getElementById('activityDescription').innerHTML || 'Descripci√≥n de la actividad aparecer√° aqu√≠...';
        const activityType = document.getElementById('selectedActivityType').value;
        const priority = document.getElementById('selectedPriority').value;
        
        // Update preview title
        document.getElementById('previewTitle').textContent = title;
        
        // Update preview date
        if (date) {
          const dateObj = new Date(date);
          document.getElementById('previewDate').textContent = dateObj.toLocaleString('es-CL');
        }
        
        // Update preview content
        document.getElementById('previewContent').innerHTML = description;
        
        // Update preview badges
        const badgesContainer = document.getElementById('previewBadges');
        badgesContainer.innerHTML = '';
        
        if (activityType) {
          const typeBadge = document.createElement('span');
          typeBadge.className = `preview-badge ${activityType}`;
          typeBadge.textContent = getActivityTypeLabel(activityType);
          badgesContainer.appendChild(typeBadge);
        }
        
        if (priority) {
          const priorityBadge = document.createElement('span');
          priorityBadge.className = `preview-badge ${priority}`;
          priorityBadge.textContent = getPriorityLabel(priority);
          badgesContainer.appendChild(priorityBadge);
        }
        
        // Update timestamp
        document.getElementById('previewTimestamp').textContent = new Date().toLocaleString('es-CL');
      }

      function getActivityTypeLabel(type) {
        const labels = {
          'system': 'Sistema',
          'user': 'Usuario',
          'security': 'Seguridad',
          'maintenance': 'Mantenimiento',
          'admin': 'Administraci√≥n',
          'financial': 'Financiero'
        };
        return labels[type] || type;
      }

      function getPriorityLabel(priority) {
        const labels = {
          'low': 'Baja',
          'normal': 'Normal',
          'high': 'Alta',
          'critical': 'Cr√≠tica'
        };
        return labels[priority] || priority;
      }

      // Form submission
      document.getElementById('bitacoraForm').addEventListener('submit', function(event) {
        event.preventDefault();
        
        // Validate required fields
        const title = document.getElementById('activityTitle').value;
        const date = document.getElementById('activityDate').value;
        const activityType = document.getElementById('selectedActivityType').value;
        const description = document.getElementById('activityDescription').innerHTML;
        
        if (!title || !date || !activityType || !description.trim()) {
          alert('Por favor, completa todos los campos obligatorios.');
          return;
        }
        
        // Show loading state
        const submitBtn = event.target.querySelector('button[type="submit"]');
        const originalContent = submitBtn.innerHTML;
        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Registrando...';
        submitBtn.disabled = true;
        
        // Simulate submission
        setTimeout(() => {
          alert('Entrada de bit√°cora registrada exitosamente');
          window.location.href = 'bitacora-listado.html';
        }, 2000);
      });

      // Save draft function
      function saveDraft() {
        const draftBtn = event.target;
        const originalContent = draftBtn.innerHTML;
        
        draftBtn.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Guardando...';
        draftBtn.disabled = true;
        
        setTimeout(() => {
          draftBtn.innerHTML = originalContent;
          draftBtn.disabled = false;
          alert('Borrador guardado exitosamente');
        }, 1500);
      }

      // Auto-save draft every 2 minutes
      setInterval(() => {
        const title = document.getElementById('activityTitle').value;
        const description = document.getElementById('activityDescription').innerHTML;
        
        if (title || description.trim()) {
          console.log('Auto-saving draft...');
          // In a real app, this would save to localStorage or send to server
        }
      }, 120000); // 2 minutes
    </script>
  </body>
</html>