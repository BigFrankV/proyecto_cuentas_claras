<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ticket #T-2024-089 - Cuentas Claras</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Tokens / overrides -->
    <link href="assets/css/style.css" rel="stylesheet">
    <style>
      /* Mobile-first Styles */
      .nav-sidebar .nav-item .nav-link { color: rgba(255,255,255,0.8); }
      .nav-sidebar .nav-item .nav-link:hover { color: #fff; background-color: rgba(255,255,255,0.1); }
      .nav-sidebar .nav-item .nav-link.active { 
        color: #fff; 
        background: rgba(253,93,20,0.2);
        border-left: 3px solid var(--color-accent);
      }
      .nav-sidebar .nav-item .nav-link.active .material-icons { color: var(--color-accent); }
      
      .sidebar {
        position: fixed;
        top: 0;
        bottom: 0;
        left: 0;
        z-index: 1000;
        transform: translateX(-100%);
        transition: transform 0.3s ease-in-out;
        width: 280px;
      }
      
      .sidebar.show {
        transform: translateX(0);
      }
      
      .sidebar-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        z-index: 999;
        background-color: rgba(0,0,0,0.5);
        display: none;
      }
      
      .sidebar-backdrop.show {
        display: block;
      }
      
      @media (min-width: 992px) {
        .sidebar {
          transform: translateX(0);
        }
        
        .main-content {
          margin-left: 280px;
        }
        
        .toggle-sidebar {
          display: none;
        }
      }
      
      .avatar {
        width: 36px;
        height: 36px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: var(--color-primary);
        color: #fff;
        font-weight: bold;
        border-radius: 50%;
      }
      
      /* Ticket status */
      .ticket-status {
        display: inline-flex;
        align-items: center;
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        font-size: 0.875rem;
        font-weight: 500;
        margin-bottom: 1rem;
      }
      
      .ticket-status.open {
        background-color: #E3F2FD;
        color: #1565C0;
        border: 1px solid #2196F3;
      }
      
      .ticket-status.in-progress {
        background-color: #FFF8E1;
        color: #F57F17;
        border: 1px solid #FFEB3B;
      }
      
      .ticket-status.resolved {
        background-color: #E8F5E9;
        color: #2E7D32;
        border: 1px solid #4CAF50;
      }
      
      .ticket-status.closed {
        background-color: #F5F5F5;
        color: #757575;
        border: 1px solid #9E9E9E;
      }
      
      .ticket-status.escalated {
        background-color: #FFEBEE;
        color: #C62828;
        border: 1px solid #F44336;
      }
      
      /* Priority badges */
      .priority-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
        font-size: 0.75rem;
        font-weight: 500;
      }
      
      .priority-badge.low {
        background-color: #E8F5E9;
        color: #2E7D32;
      }
      
      .priority-badge.medium {
        background-color: #FFF8E1;
        color: #F57F17;
      }
      
      .priority-badge.high {
        background-color: #FFEBEE;
        color: #C62828;
      }
      
      .priority-badge.urgent {
        background-color: #7B1FA2;
        color: #FFFFFF;
      }
      
      /* Category badges */
      .category-badge {
        display: inline-flex;
        align-items: center;
        padding: 0.25rem 0.5rem;
        border-radius: 0.375rem;
        font-size: 0.75rem;
        font-weight: 500;
        background-color: #F3E5F5;
        color: #7B1FA2;
      }
      
      /* Info cards */
      .info-card {
        background-color: #fff;
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: var(--shadow-sm);
        border: 1px solid #e9ecef;
      }
      
      .info-card-title {
        font-size: 1.1rem;
        font-weight: 600;
        color: #212529;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #e9ecef;
        display: flex;
        align-items: center;
      }
      
      .info-card-title .material-icons {
        margin-right: 0.5rem;
        color: var(--color-primary);
      }
      
      .info-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 0;
        border-bottom: 1px solid #f8f9fa;
      }
      
      .info-item:last-child {
        border-bottom: none;
      }
      
      .info-label {
        font-weight: 500;
        color: #6c757d;
      }
      
      .info-value {
        font-weight: 600;
        color: #212529;
        text-align: right;
      }
      
      /* Tabs */
      .nav-tabs .nav-link {
        border: none;
        color: #6c757d;
        font-weight: 500;
        padding: 1rem 1.5rem;
        margin-right: 0.5rem;
        border-radius: 0.5rem 0.5rem 0 0;
      }
      
      .nav-tabs .nav-link:hover {
        border: none;
        background-color: rgba(253,93,20,0.05);
        color: var(--color-primary);
      }
      
      .nav-tabs .nav-link.active {
        background-color: #fff;
        color: var(--color-primary);
        border: 1px solid #e9ecef;
        border-bottom: 1px solid #fff;
        margin-bottom: -1px;
      }
      
      .tab-content {
        background-color: #fff;
        border: 1px solid #e9ecef;
        border-radius: 0 0.5rem 0.5rem 0.5rem;
        padding: 1.5rem;
        box-shadow: var(--shadow-sm);
      }
      
      /* Timeline */
      .timeline {
        position: relative;
        padding-left: 2rem;
      }
      
      .timeline::before {
        content: '';
        position: absolute;
        left: 0.75rem;
        top: 0;
        bottom: 0;
        width: 2px;
        background-color: #e9ecef;
      }
      
      .timeline-item {
        position: relative;
        margin-bottom: 1.5rem;
      }
      
      .timeline-item::before {
        content: '';
        position: absolute;
        left: -0.5rem;
        top: 0.5rem;
        width: 1rem;
        height: 1rem;
        border-radius: 50%;
        background-color: var(--color-primary);
      }
      
      .timeline-item.system::before {
        background-color: #6c757d;
      }
      
      .timeline-item.comment::before {
        background-color: #17a2b8;
      }
      
      .timeline-item.status-change::before {
        background-color: #28a745;
      }
      
      .timeline-item.priority-change::before {
        background-color: #ffc107;
      }
      
      .timeline-content {
        background-color: #f8f9fa;
        padding: 1rem;
        border-radius: var(--radius);
        border-left: 3px solid var(--color-primary);
      }
      
      .timeline-item.system .timeline-content {
        border-left-color: #6c757d;
      }
      
      .timeline-item.comment .timeline-content {
        border-left-color: #17a2b8;
      }
      
      .timeline-item.status-change .timeline-content {
        border-left-color: #28a745;
      }
      
      .timeline-item.priority-change .timeline-content {
        border-left-color: #ffc107;
      }
      
      .timeline-date {
        font-size: 0.875rem;
        color: #6c757d;
        margin-bottom: 0.25rem;
      }
      
      .timeline-author {
        font-weight: 600;
        color: #212529;
        margin-bottom: 0.25rem;
      }
      
      .timeline-description {
        color: #495057;
        margin-bottom: 0;
      }
      
      /* Comments */
      .comment-form {
        background-color: #f8f9fa;
        border-radius: var(--radius);
        padding: 1rem;
        margin-bottom: 1rem;
      }
      
      .comment-actions {
        display: flex;
        justify-content: between;
        gap: 0.5rem;
        margin-top: 1rem;
      }
      
      /* Attachments */
      .attachment-item {
        display: flex;
        align-items: center;
        padding: 0.75rem;
        background-color: #f8f9fa;
        border-radius: var(--radius);
        margin-bottom: 0.5rem;
        border: 1px solid #e9ecef;
      }
      
      .attachment-icon {
        width: 40px;
        height: 40px;
        border-radius: 0.25rem;
        background-color: var(--color-primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 0.75rem;
        font-size: 1.2rem;
      }
      
      .attachment-info {
        flex: 1;
      }
      
      .attachment-name {
        font-weight: 500;
        margin-bottom: 0.25rem;
      }
      
      .attachment-meta {
        font-size: 0.75rem;
        color: #6c757d;
        margin: 0;
      }
      
      .attachment-actions {
        display: flex;
        gap: 0.5rem;
      }
      
      /* Action buttons */
      .action-button {
        border: none;
        border-radius: var(--radius);
        padding: 0.75rem 1.5rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        text-decoration: none;
      }
      
      .action-button .material-icons {
        margin-right: 0.5rem;
        font-size: 1.1rem;
      }
      
      .action-button.primary {
        background-color: var(--color-primary);
        color: white;
      }
      
      .action-button.primary:hover {
        background-color: #e85a14;
        color: white;
      }
      
      .action-button.success {
        background-color: #28a745;
        color: white;
      }
      
      .action-button.success:hover {
        background-color: #218838;
        color: white;
      }
      
      .action-button.warning {
        background-color: #ffc107;
        color: #212529;
      }
      
      .action-button.warning:hover {
        background-color: #e0a800;
        color: #212529;
      }
      
      .action-button.danger {
        background-color: #dc3545;
        color: white;
      }
      
      .action-button.danger:hover {
        background-color: #c82333;
        color: white;
      }
      
      .action-button.outline {
        background-color: transparent;
        color: #6c757d;
        border: 1px solid #6c757d;
      }
      
      .action-button.outline:hover {
        background-color: #6c757d;
        color: white;
      }
      
      /* Assignee selector */
      .assignee-current {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
      }
      
      .assignee-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: var(--color-primary);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        margin-right: 0.75rem;
      }
      
      .assignee-info {
        flex: 1;
      }
      
      .assignee-name {
        font-weight: 600;
        margin-bottom: 0.25rem;
      }
      
      .assignee-role {
        font-size: 0.875rem;
        color: #6c757d;
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div class="d-flex">
      <!-- Sidebar -->
      <div class="sidebar d-flex flex-column flex-shrink-0 p-3 text-white bg-dark" style="background: linear-gradient(180deg, var(--color-primary) 0%, #071a38 100%) !important;">
        <a href="dashboard.html" class="d-flex align-items-center text-white text-decoration-none mb-4">
          <span class="material-icons me-2" style="font-size: 32px;">apartment</span>
          <span class="fs-4">Cuentas Claras</span>
        </a>
        
        <div class="d-flex align-items-center mb-3 px-2">
          <div class="avatar me-2" style="background-color: var(--color-accent);">PC</div>
          <div>
            <span class="d-block text-white">Patricia Contreras</span>
            <span class="small text-white-50">Administradora</span>
          </div>
        </div>
        
        <hr>
        
        <ul class="nav nav-sidebar flex-column mb-auto">
          <li class="nav-item">
            <a href="dashboard.html" class="nav-link px-3 py-2 mb-1">
              <span class="material-icons align-middle me-2">dashboard</span>
              <span>Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="comunidades-listado.html" class="nav-link px-3 py-2 mb-1">
              <span class="material-icons align-middle me-2">domain</span>
              <span>Comunidades</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="unidades-listado.html" class="nav-link px-3 py-2 mb-1">
              <span class="material-icons align-middle me-2">apartment</span>
              <span>Unidades</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="personas-listado.html" class="nav-link px-3 py-2 mb-1">
              <span class="material-icons align-middle me-2">people</span>
              <span>Personas</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="reportes-dashboard.html" class="nav-link px-3 py-2 mb-1">
              <span class="material-icons align-middle me-2">bar_chart</span>
              <span>Reportes</span>
            </a>
          </li>
          <li class="nav-item">
            <a href="tickets-listado.html" class="nav-link active px-3 py-2 mb-1">
              <span class="material-icons align-middle me-2">support</span>
              <span>Soporte</span>
            </a>
          </li>
        </ul>
        
        <hr>
        
        <div class="dropdown">
          <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="userDropdown" data-bs-toggle="dropdown">
            <span class="material-icons me-2">settings</span>
            <span>Configuración</span>
          </a>
          <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="userDropdown">
            <li><a class="dropdown-item" href="profile.html">Mi Perfil</a></li>
            <li><a class="dropdown-item" href="#">Configuración</a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item text-danger" href="login.html">Cerrar Sesión</a></li>
          </ul>
        </div>
      </div>
      
      <!-- Sidebar backdrop for mobile -->
      <div class="sidebar-backdrop" onclick="toggleSidebar()"></div>
      
      <!-- Contenido principal -->
      <div class="main-content flex-grow-1 bg-light">
        <!-- Header con búsqueda y notificaciones -->
        <header class="bg-white border-bottom shadow-sm p-3">
          <div class="container-fluid">
            <div class="row align-items-center">
              <div class="col-lg-6">
                <button class="btn toggle-sidebar d-lg-none me-2" onclick="toggleSidebar()">
                  <span class="material-icons">menu</span>
                </button>
                <div class="d-flex align-items-center">
                  <a href="tickets-listado.html" class="text-decoration-none text-muted me-2">
                    <span class="material-icons">arrow_back</span>
                  </a>
                  <div>
                    <h5 class="mb-0">Ticket #T-2024-089</h5>
                    <small class="text-muted">Problema con acceso principal</small>
                  </div>
                </div>
              </div>
              
              <div class="col-lg-6">
                <div class="d-flex justify-content-end align-items-center">
                  <div class="me-3">
                    <button class="btn position-relative p-0" type="button" data-bs-toggle="dropdown">
                      <span class="material-icons">notifications</span>
                      <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
                        3
                      </span>
                    </button>
                  </div>
                  
                  <div class="dropdown">
                    <a href="#" class="d-flex align-items-center text-dark text-decoration-none dropdown-toggle" id="userMenu" data-bs-toggle="dropdown" aria-expanded="false">
                      <div class="avatar me-2" style="background-color: var(--color-accent);">PC</div>
                      <div class="d-none d-sm-block">
                        <div class="fw-bold">Patricia Contreras</div>
                        <small class="text-muted">Administradora</small>
                      </div>
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenu">
                      <li><a class="dropdown-item" href="profile.html">Mi Perfil</a></li>
                      <li><a class="dropdown-item" href="#">Configuración</a></li>
                      <li><hr class="dropdown-divider"></li>
                      <li><a class="dropdown-item text-danger" href="login.html">Cerrar Sesión</a></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </header>

        <!-- Contenido -->
        <main class="container-fluid p-4">
          <div class="row">
            <!-- Columna principal -->
            <div class="col-lg-8">
              <!-- Encabezado con estado -->
              <div class="d-flex justify-content-between align-items-start mb-4 flex-wrap gap-3">
                <div>
                  <div class="ticket-status open">
                    <span class="material-icons me-2">schedule</span>
                    Abierto
                  </div>
                  <h2 class="h4 mb-1">Problema con acceso principal</h2>
                  <p class="text-muted mb-0">Creado el 15/09/2024 • Última actualización: 15/09/2024 08:45</p>
                </div>
                <div class="d-flex gap-2 flex-wrap">
                  <span class="priority-badge high">Alta</span>
                  <span class="category-badge">Accesos</span>
                </div>
              </div>

              <!-- Botones de acción -->
              <div class="d-flex flex-wrap gap-2 mb-4">
                <button class="action-button success" onclick="markAsResolved()">
                  <span class="material-icons">check_circle</span>
                  Marcar como Resuelto
                </button>
                <button class="action-button warning" onclick="escalateTicket()">
                  <span class="material-icons">trending_up</span>
                  Escalar
                </button>
                <button class="action-button primary" data-bs-toggle="modal" data-bs-target="#assignModal">
                  <span class="material-icons">person_add</span>
                  Reasignar
                </button>
                <button class="action-button outline" data-bs-toggle="modal" data-bs-target="#editModal">
                  <span class="material-icons">edit</span>
                  Editar
                </button>
              </div>

              <!-- Tabs -->
              <ul class="nav nav-tabs" id="ticketDetailTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">
                    <span class="material-icons me-2">info</span>
                    Detalles
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="timeline-tab" data-bs-toggle="tab" data-bs-target="#timeline" type="button" role="tab">
                    <span class="material-icons me-2">timeline</span>
                    Actividad
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="comments-tab" data-bs-toggle="tab" data-bs-target="#comments" type="button" role="tab">
                    <span class="material-icons me-2">chat</span>
                    Comentarios
                  </button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="attachments-tab" data-bs-toggle="tab" data-bs-target="#attachments" type="button" role="tab">
                    <span class="material-icons me-2">attach_file</span>
                    Adjuntos
                  </button>
                </li>
              </ul>

              <div class="tab-content" id="ticketDetailTabsContent">
                <!-- Detalles -->
                <div class="tab-pane fade show active" id="overview" role="tabpanel">
                  <h6 class="mb-3">Descripción del Problema</h6>
                  <div class="bg-light p-3 rounded mb-4">
                    <p class="mb-0">
                      Buenos días, tengo un problema con mi tarjeta de acceso al edificio. Desde ayer por la noche no 
                      funciona en la puerta principal. He intentado varias veces pero no se activa la cerradura. 
                      Necesito ayuda urgente ya que no puedo entrar al edificio sin ayuda del conserje.
                    </p>
                  </div>
                  
                  <h6 class="mb-3">Detalles Técnicos</h6>
                  <div class="row">
                    <div class="col-md-6">
                      <div class="info-item">
                        <span class="info-label">Fecha de Reporte:</span>
                        <span class="info-value">15/09/2024 08:30</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Última Actualización:</span>
                        <span class="info-value">15/09/2024 08:45</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Tiempo Transcurrido:</span>
                        <span class="info-value">2 horas 15 minutos</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">SLA Estimado:</span>
                        <span class="info-value text-warning">24 horas</span>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <div class="info-item">
                        <span class="info-label">Canal de Reporte:</span>
                        <span class="info-value">Formulario Web</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Ubicación Afectada:</span>
                        <span class="info-value">Acceso Principal</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Impacto:</span>
                        <span class="info-value">Individual</span>
                      </div>
                      <div class="info-item">
                        <span class="info-label">Intentos de Solución:</span>
                        <span class="info-value">0</span>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Timeline de Actividad -->
                <div class="tab-pane fade" id="timeline" role="tabpanel">
                  <div class="timeline">
                    <div class="timeline-item">
                      <div class="timeline-content">
                        <div class="timeline-date">15/09/2024 - 08:45</div>
                        <div class="timeline-author">José Rodríguez (Agente)</div>
                        <div class="timeline-description">Ticket asignado automáticamente por categoría "Accesos"</div>
                      </div>
                    </div>
                    
                    <div class="timeline-item system">
                      <div class="timeline-content">
                        <div class="timeline-date">15/09/2024 - 08:35</div>
                        <div class="timeline-author">Sistema</div>
                        <div class="timeline-description">Notificación automática enviada al residente</div>
                      </div>
                    </div>
                    
                    <div class="timeline-item">
                      <div class="timeline-content">
                        <div class="timeline-date">15/09/2024 - 08:30</div>
                        <div class="timeline-author">María González (Residente)</div>
                        <div class="timeline-description">Ticket creado: "Problema con acceso principal"</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Comentarios -->
                <div class="tab-pane fade" id="comments" role="tabpanel">
                  <div class="comment-form">
                    <h6 class="mb-3">Agregar Comentario</h6>
                    <textarea class="form-control mb-3" rows="4" placeholder="Escribir comentario o respuesta..." id="commentText"></textarea>
                    <div class="comment-actions">
                      <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="notifyResident" checked>
                        <label class="form-check-label" for="notifyResident">
                          Notificar al residente
                        </label>
                      </div>
                      <div class="ms-auto">
                        <button class="btn btn-primary" onclick="addComment()">
                          <span class="material-icons me-1">send</span>
                          Enviar
                        </button>
                      </div>
                    </div>
                  </div>
                  
                  <div class="alert alert-info">
                    <span class="material-icons me-2">info</span>
                    <strong>Sin comentarios aún.</strong> Sé el primero en responder al residente.
                  </div>
                </div>

                <!-- Adjuntos -->
                <div class="tab-pane fade" id="attachments" role="tabpanel">
                  <div class="d-flex justify-content-between align-items-center mb-3">
                    <h6 class="mb-0">Archivos Adjuntos</h6>
                    <button class="btn btn-primary btn-sm" onclick="addAttachment()">
                      <span class="material-icons me-1">add</span>
                      Agregar Archivo
                    </button>
                  </div>
                  
                  <div class="alert alert-secondary">
                    <span class="material-icons me-2">info</span>
                    <strong>Sin archivos adjuntos.</strong> El residente no incluyó evidencia adicional.
                  </div>
                </div>
              </div>
            </div>

            <!-- Columna lateral -->
            <div class="col-lg-4">
              <!-- Información del Solicitante -->
              <div class="info-card">
                <div class="info-card-title">
                  <span class="material-icons">person</span>
                  Solicitante
                </div>
                <div class="info-item">
                  <span class="info-label">Nombre:</span>
                  <span class="info-value">María González</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Unidad:</span>
                  <span class="info-value">Torre Norte - 4A</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Email:</span>
                  <span class="info-value">maria.gonzalez@email.com</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Teléfono:</span>
                  <span class="info-value">+56 9 8765 4321</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Tipo:</span>
                  <span class="info-value">Propietario residente</span>
                </div>
                <div class="mt-3">
                  <button class="btn btn-outline-primary btn-sm w-100" onclick="contactResident()">
                    <span class="material-icons me-1">mail</span>
                    Contactar Residente
                  </button>
                </div>
              </div>

              <!-- Asignación Actual -->
              <div class="info-card">
                <div class="info-card-title">
                  <span class="material-icons">assignment_ind</span>
                  Asignación
                </div>
                <div class="assignee-current">
                  <div class="assignee-avatar">JR</div>
                  <div class="assignee-info">
                    <div class="assignee-name">José Rodríguez</div>
                    <div class="assignee-role">Técnico de Mantenimiento</div>
                  </div>
                </div>
                <div class="info-item">
                  <span class="info-label">Asignado desde:</span>
                  <span class="info-value">15/09/2024 08:45</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Tiempo asignado:</span>
                  <span class="info-value">2 horas</span>
                </div>
                <div class="mt-3">
                  <button class="btn btn-outline-primary btn-sm w-100" data-bs-toggle="modal" data-bs-target="#assignModal">
                    <span class="material-icons me-1">swap_horiz</span>
                    Reasignar Ticket
                  </button>
                </div>
              </div>

              <!-- Información del Ticket -->
              <div class="info-card">
                <div class="info-card-title">
                  <span class="material-icons">info</span>
                  Información del Ticket
                </div>
                <div class="info-item">
                  <span class="info-label">ID:</span>
                  <span class="info-value">#T-2024-089</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Estado:</span>
                  <span class="info-value">
                    <span class="ticket-status open">Abierto</span>
                  </span>
                </div>
                <div class="info-item">
                  <span class="info-label">Prioridad:</span>
                  <span class="info-value">
                    <span class="priority-badge high">Alta</span>
                  </span>
                </div>
                <div class="info-item">
                  <span class="info-label">Categoría:</span>
                  <span class="info-value">
                    <span class="category-badge">Accesos</span>
                  </span>
                </div>
                <div class="info-item">
                  <span class="info-label">SLA:</span>
                  <span class="info-value text-warning">21h 45m restantes</span>
                </div>
                <div class="info-item">
                  <span class="info-label">Vencimiento:</span>
                  <span class="info-value">16/09/2024 08:30</span>
                </div>
              </div>

              <!-- Tickets Relacionados -->
              <div class="info-card">
                <div class="info-card-title">
                  <span class="material-icons">link</span>
                  Tickets Relacionados
                </div>
                <div class="alert alert-secondary mb-0">
                  <span class="material-icons me-2">info</span>
                  No hay tickets relacionados
                </div>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- Modal para reasignar ticket -->
    <div class="modal fade" id="assignModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Reasignar Ticket #T-2024-089</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="newAssignee" class="form-label">Asignar a *</label>
              <select class="form-select" id="newAssignee" required>
                <option value="">Seleccionar agente</option>
                <option value="pc">Patricia Contreras - Administradora</option>
                <option value="jr" selected>José Rodríguez - Técnico de Mantenimiento</option>
                <option value="ml">María López - Asistente Administrativa</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="assignReason" class="form-label">Motivo de Reasignación</label>
              <textarea class="form-control" id="assignReason" rows="3" placeholder="Explica por qué se reasigna este ticket..."></textarea>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="notifyNewAssignee" checked>
              <label class="form-check-label" for="notifyNewAssignee">
                Notificar al nuevo agente asignado
              </label>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" onclick="reassignTicket()">
              <span class="material-icons me-1">person_add</span>
              Reasignar
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal para editar ticket -->
    <div class="modal fade" id="editModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Editar Ticket #T-2024-089</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="editSubject" class="form-label">Asunto</label>
                <input type="text" class="form-control" id="editSubject" value="Problema con acceso principal">
              </div>
              <div class="mb-3">
                <label for="editDescription" class="form-label">Descripción</label>
                <textarea class="form-control" id="editDescription" rows="4">Buenos días, tengo un problema con mi tarjeta de acceso al edificio. Desde ayer por la noche no funciona en la puerta principal. He intentado varias veces pero no se activa la cerradura. Necesito ayuda urgente ya que no puedo entrar al edificio sin ayuda del conserje.</textarea>
              </div>
              <div class="row">
                <div class="col-md-4 mb-3">
                  <label for="editStatus" class="form-label">Estado</label>
                  <select class="form-select" id="editStatus">
                    <option value="open" selected>Abierto</option>
                    <option value="in-progress">En Progreso</option>
                    <option value="resolved">Resuelto</option>
                    <option value="closed">Cerrado</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="editPriority" class="form-label">Prioridad</label>
                  <select class="form-select" id="editPriority">
                    <option value="low">Baja</option>
                    <option value="medium">Media</option>
                    <option value="high" selected>Alta</option>
                    <option value="urgent">Urgente</option>
                  </select>
                </div>
                <div class="col-md-4 mb-3">
                  <label for="editCategory" class="form-label">Categoría</label>
                  <select class="form-select" id="editCategory">
                    <option value="technical">Técnico</option>
                    <option value="billing">Facturación</option>
                    <option value="maintenance">Mantenimiento</option>
                    <option value="access" selected>Accesos</option>
                    <option value="amenities">Amenidades</option>
                    <option value="general">General</option>
                  </select>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="button" class="btn btn-primary" onclick="updateTicket()">
              <span class="material-icons me-1">save</span>
              Guardar Cambios
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Flatpickr JS -->
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/es.js"></script>
    <script src="assets/js/script.js"></script>
    <script>
      function toggleSidebar() {
        const sidebar = document.querySelector('.sidebar');
        const backdrop = document.querySelector('.sidebar-backdrop');
        
        sidebar.classList.toggle('show');
        backdrop.classList.toggle('show');
      }

      function markAsResolved() {
        if (confirm('¿Marcar este ticket como resuelto?')) {
          // Simulate resolving
          setTimeout(() => {
            alert('Ticket marcado como resuelto');
            // Update status badge
            const statusBadge = document.querySelector('.ticket-status');
            statusBadge.className = 'ticket-status resolved';
            statusBadge.innerHTML = '<span class="material-icons me-2">check_circle</span>Resuelto';
            
            // Add timeline entry
            addTimelineEntry('status-change', 'Patricia Contreras (Administradora)', 'Ticket marcado como resuelto');
          }, 1000);
        }
      }

      function escalateTicket() {
        if (confirm('¿Escalar este ticket a prioridad urgente?')) {
          // Simulate escalation
          setTimeout(() => {
            alert('Ticket escalado exitosamente');
            // Update priority badge
            const priorityBadge = document.querySelector('.priority-badge');
            priorityBadge.className = 'priority-badge urgent';
            priorityBadge.textContent = 'Urgente';
            
            // Add timeline entry
            addTimelineEntry('priority-change', 'Patricia Contreras (Administradora)', 'Ticket escalado a prioridad urgente');
          }, 1000);
        }
      }

      function reassignTicket() {
        const newAssignee = document.getElementById('newAssignee').value;
        const reason = document.getElementById('assignReason').value;
        
        if (!newAssignee) {
          alert('Selecciona un agente');
          return;
        }
        
        // Simulate reassignment
        setTimeout(() => {
          alert('Ticket reasignado exitosamente');
          
          // Update assignee info
          const assigneeNames = {
            'pc': { name: 'Patricia Contreras', initials: 'PC', role: 'Administradora' },
            'jr': { name: 'José Rodríguez', initials: 'JR', role: 'Técnico de Mantenimiento' },
            'ml': { name: 'María López', initials: 'ML', role: 'Asistente Administrativa' }
          };
          
          const agent = assigneeNames[newAssignee];
          if (agent) {
            document.querySelector('.assignee-avatar').textContent = agent.initials;
            document.querySelector('.assignee-name').textContent = agent.name;
            document.querySelector('.assignee-role').textContent = agent.role;
            
            // Add timeline entry
            addTimelineEntry('system', 'Sistema', `Ticket reasignado a ${agent.name}${reason ? ': ' + reason : ''}`);
          }
          
          // Close modal
          const modal = bootstrap.Modal.getInstance(document.getElementById('assignModal'));
          modal.hide();
        }, 1000);
      }

      function updateTicket() {
        // Simulate update
        setTimeout(() => {
          alert('Ticket actualizado exitosamente');
          
          // Add timeline entry
          addTimelineEntry('system', 'Patricia Contreras (Administradora)', 'Ticket actualizado');
          
          // Close modal
          const modal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
          modal.hide();
        }, 1000);
      }

      function addComment() {
        const commentText = document.getElementById('commentText').value.trim();
        if (!commentText) {
          alert('Escribe un comentario');
          return;
        }
        
        // Simulate adding comment
        setTimeout(() => {
          alert('Comentario agregado exitosamente');
          
          // Clear textarea
          document.getElementById('commentText').value = '';
          
          // Add timeline entry
          addTimelineEntry('comment', 'Patricia Contreras (Administradora)', commentText);
        }, 500);
      }

      function contactResident() {
        if (confirm('¿Enviar email al residente María González?')) {
          setTimeout(() => {
            alert('Email enviado exitosamente');
            
            // Add timeline entry
            addTimelineEntry('system', 'Sistema', 'Email enviado al residente');
          }, 1000);
        }
      }

      function addAttachment() {
        const input = document.createElement('input');
        input.type = 'file';
        input.multiple = true;
        input.accept = 'image/*,video/*,.pdf,.doc,.docx';
        input.onchange = function(e) {
          const files = Array.from(e.target.files);
          if (files.length > 0) {
            alert(`${files.length} archivo(s) agregado(s)`);
            
            // Add timeline entry
            addTimelineEntry('system', 'Patricia Contreras (Administradora)', `${files.length} archivo(s) adjuntado(s)`);
          }
        };
        input.click();
      }

      function addTimelineEntry(type, author, description) {
        const timeline = document.querySelector('.timeline');
        const now = new Date();
        const timeString = now.toLocaleString('es-CL', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        const timelineItem = document.createElement('div');
        timelineItem.className = `timeline-item ${type}`;
        timelineItem.innerHTML = `
          <div class="timeline-content">
            <div class="timeline-date">${timeString}</div>
            <div class="timeline-author">${author}</div>
            <div class="timeline-description">${description}</div>
          </div>
        `;
        
        // Insert at the beginning
        timeline.insertBefore(timelineItem, timeline.firstChild);
      }
    </script>
  </body>
</html>