# ğŸ¨ Arquitectura de IntegraciÃ³n - MÃ³dulo Gastos

## ğŸ“ Diagrama de Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (Next.js)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    PÃGINAS (6)                              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ gastos/  â”‚ gastos/  â”‚ gastos/  â”‚ gastos/  â”‚ gastos/  â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ index    â”‚ nuevo    â”‚  [id]    â”‚  editar  â”‚ reportes â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚          â”‚          â”‚          â”‚          â”‚           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              API CLIENT (gastos.ts)                         â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚  21 funciones API + 13 interfaces TypeScript        â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   HTTP/HTTPS (axios)   â”‚
                    â”‚    Bearer Token JWT    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BACKEND (Node.js/Express)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              ROUTER (gastos.js)                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  19 endpoints REST API + Middleware de seguridad     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â”‚                                           â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Middleware    â”‚                      â”‚    Controllers     â”‚  â”‚
â”‚  â”‚  - auth        â”‚                      â”‚    - CRUD          â”‚  â”‚
â”‚  â”‚  - permissions â”‚                      â”‚    - Reports       â”‚  â”‚
â”‚  â”‚  - validation  â”‚                      â”‚    - Approvals     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                              â”‚                                    â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚      DB Client (db.js) â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚     MySQL Database        â”‚
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                  â”‚  â”‚ Tablas:            â”‚  â”‚
                  â”‚  â”‚ - gasto            â”‚  â”‚
                  â”‚  â”‚ - categoria_gasto  â”‚  â”‚
                  â”‚  â”‚ - gasto_aprobacion â”‚  â”‚
                  â”‚  â”‚ - historial_gasto  â”‚  â”‚
                  â”‚  â”‚ - archivos         â”‚  â”‚
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flujo de Datos: Crear Gasto

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario  â”‚         â”‚ Frontend â”‚         â”‚ Backend  â”‚         â”‚   MySQL  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  1. Llena form     â”‚                    â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚  2. Click "Guardar"â”‚                    â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚ 3. POST /gastos    â”‚                    â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
     â”‚                    â”‚   + JWT Token      â”‚                    â”‚
     â”‚                    â”‚   + FormData       â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 4. Validate token  â”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
     â”‚                    â”‚                    â”‚         â”‚          â”‚
     â”‚                    â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 5. Validate data   â”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
     â”‚                    â”‚                    â”‚         â”‚          â”‚
     â”‚                    â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 6. INSERT gasto    â”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 7. Get insert ID   â”‚
     â”‚                    â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 8. INSERT historialâ”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚ 9. Response 201    â”‚                    â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
     â”‚                    â”‚   {success: true,  â”‚                    â”‚
     â”‚                    â”‚    data: {...}}    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚ 10. Redirect /gastos/:id               â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚ 11. GET /gastos/:idâ”‚                    â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚ 12. Muestra detalleâ”‚                    â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                    â”‚                    â”‚
```

---

## ğŸ”„ Flujo de Datos: Aprobar Gasto

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario  â”‚         â”‚ Frontend â”‚         â”‚ Backend  â”‚         â”‚   MySQL  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚ 1. Click "Aprobar" â”‚                    â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚ 2. Modal aparece   â”‚                    â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚ 3. Escribe comentario                   â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚ 4. Confirma        â”‚                    â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚ 5. POST /gastos/:id/aprobaciones        â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
     â”‚                    â”‚ {estado: "aprobado",                    â”‚
     â”‚                    â”‚  comentario: "..."}â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 6. Check permissionsâ”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
     â”‚                    â”‚                    â”‚         â”‚          â”‚
     â”‚                    â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 7. GET gasto actualâ”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 8. Calculate requiredâ”‚
     â”‚                    â”‚                    â”‚    approvals       â”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
     â”‚                    â”‚                    â”‚         â”‚          â”‚
     â”‚                    â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 9. INSERT aprobacionâ”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 10. UPDATE gasto   â”‚
     â”‚                    â”‚                    â”‚     estado         â”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 11. INSERT historialâ”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚ 12. Response OK    â”‚                    â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚ 13. Actualiza vistaâ”‚                    â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
```

---

## ğŸ”„ Flujo de Datos: Cargar Reportes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Usuario  â”‚         â”‚ Frontend â”‚         â”‚ Backend  â”‚         â”‚   MySQL  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚ 1. Click "Reportes"â”‚                    â”‚                    â”‚
     â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚ 2. Promise.all([   â”‚                    â”‚
     â”‚                    â”‚    GET /por-categoria,                  â”‚
     â”‚                    â”‚    GET /por-proveedor,                  â”‚
     â”‚                    â”‚    GET /por-centro-costo,               â”‚
     â”‚                    â”‚    GET /evolucion-temporal,             â”‚
     â”‚                    â”‚    GET /top-gastos,                     â”‚
     â”‚                    â”‚    GET /pendientes-aprobacion,          â”‚
     â”‚                    â”‚    GET /alertas                         â”‚
     â”‚                    â”‚ ])                 â”‚                    â”‚
     â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                    â”‚
     â”‚                    â”‚ (8 requests)       â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 3. Execute queries â”‚
     â”‚                    â”‚                    â”‚    in parallel     â”‚
     â”‚                    â”‚                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                    â”‚                    â”‚ (8 queries)        â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚ 4. Process results â”‚
     â”‚                    â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚                    â”‚ 5. Response (8)    â”‚                    â”‚
     â”‚                    â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
     â”‚ 6. Render all reports                   â”‚                    â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚                    â”‚
     â”‚    - Por categorÃ­a â”‚                    â”‚                    â”‚
     â”‚    - Por proveedor â”‚                    â”‚                    â”‚
     â”‚    - Por centro    â”‚                    â”‚                    â”‚
     â”‚    - EvoluciÃ³n     â”‚                    â”‚                    â”‚
     â”‚    - Top gastos    â”‚                    â”‚                    â”‚
     â”‚    - Pendientes    â”‚                    â”‚                    â”‚
     â”‚    - Alertas       â”‚                    â”‚                    â”‚
     â”‚                    â”‚                    â”‚                    â”‚
```

---

## ğŸ“Š Estructura de Datos: Gasto Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        GASTO DETALLE                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  InformaciÃ³n BÃ¡sica (gasto table)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ id: 1                                                   â”‚ â”‚
â”‚  â”‚ numero: "G-2025-001"                                    â”‚ â”‚
â”‚  â”‚ comunidad_id: 1                                         â”‚ â”‚
â”‚  â”‚ categoria_id: 1                                         â”‚ â”‚
â”‚  â”‚ centro_costo_id: 1                                      â”‚ â”‚
â”‚  â”‚ fecha: "2025-10-01"                                     â”‚ â”‚
â”‚  â”‚ monto: 150000.00                                        â”‚ â”‚
â”‚  â”‚ glosa: "Mantenimiento ascensor"                         â”‚ â”‚
â”‚  â”‚ extraordinario: false                                   â”‚ â”‚
â”‚  â”‚ estado: "aprobado"                                      â”‚ â”‚
â”‚  â”‚ creado_por: 1                                           â”‚ â”‚
â”‚  â”‚ aprobado_por: 2                                         â”‚ â”‚
â”‚  â”‚ created_at: "2025-10-01T10:00:00Z"                      â”‚ â”‚
â”‚  â”‚ updated_at: "2025-10-02T15:30:00Z"                      â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  Datos Enriquecidos (JOINs)                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ categoria_nombre: "Mantenimiento"                       â”‚ â”‚
â”‚  â”‚ centro_costo_nombre: "Ascensores"                       â”‚ â”‚
â”‚  â”‚ creado_por_nombre: "Patricio Quintanilla"               â”‚ â”‚
â”‚  â”‚ aprobado_por_nombre: "Elisabet Robledo"                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  Aprobaciones (gasto_aprobacion table)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [                                                       â”‚ â”‚
â”‚  â”‚   {                                                     â”‚ â”‚
â”‚  â”‚     id: 1,                                              â”‚ â”‚
â”‚  â”‚     usuario_id: 2,                                      â”‚ â”‚
â”‚  â”‚     usuario_nombre: "Elisabet Robledo",                 â”‚ â”‚
â”‚  â”‚     rol_id: 2,                                          â”‚ â”‚
â”‚  â”‚     rol_codigo: "admin_comunidad",                      â”‚ â”‚
â”‚  â”‚     rol_nombre: "Admin Comunidad",                      â”‚ â”‚
â”‚  â”‚     estado: "aprobado",                                 â”‚ â”‚
â”‚  â”‚     comentario: "Aprobado",                             â”‚ â”‚
â”‚  â”‚     fecha_aprobacion: "2025-10-02T15:30:00Z"            â”‚ â”‚
â”‚  â”‚   }                                                     â”‚ â”‚
â”‚  â”‚ ]                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  Historial (historial_gasto table)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [                                                       â”‚ â”‚
â”‚  â”‚   {                                                     â”‚ â”‚
â”‚  â”‚     id: 1,                                              â”‚ â”‚
â”‚  â”‚     tipo_cambio: "CREATE",                              â”‚ â”‚
â”‚  â”‚     usuario_nombre: "Patricio Quintanilla",             â”‚ â”‚
â”‚  â”‚     fecha: "2025-10-01T10:00:00Z"                       â”‚ â”‚
â”‚  â”‚   },                                                    â”‚ â”‚
â”‚  â”‚   {                                                     â”‚ â”‚
â”‚  â”‚     id: 2,                                              â”‚ â”‚
â”‚  â”‚     tipo_cambio: "UPDATE",                              â”‚ â”‚
â”‚  â”‚     campo_modificado: "estado",                         â”‚ â”‚
â”‚  â”‚     valor_anterior: "pendiente",                        â”‚ â”‚
â”‚  â”‚     valor_nuevo: "aprobado",                            â”‚ â”‚
â”‚  â”‚     usuario_nombre: "Elisabet Robledo",                 â”‚ â”‚
â”‚  â”‚     fecha: "2025-10-02T15:30:00Z"                       â”‚ â”‚
â”‚  â”‚   }                                                     â”‚ â”‚
â”‚  â”‚ ]                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  Archivos (archivos table)                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [                                                       â”‚ â”‚
â”‚  â”‚   {                                                     â”‚ â”‚
â”‚  â”‚     id: 1,                                              â”‚ â”‚
â”‚  â”‚     nombre_archivo: "factura_ascensor.pdf",             â”‚ â”‚
â”‚  â”‚     ruta: "/uploads/2025/10/factura.pdf",               â”‚ â”‚
â”‚  â”‚     tipo_archivo: "application/pdf",                    â”‚ â”‚
â”‚  â”‚     tamano: 524288,                                     â”‚ â”‚
â”‚  â”‚     subido_por: 1,                                      â”‚ â”‚
â”‚  â”‚     subido_por_nombre: "Patricio Quintanilla",          â”‚ â”‚
â”‚  â”‚     created_at: "2025-10-01T10:05:00Z"                  â”‚ â”‚
â”‚  â”‚   }                                                     â”‚ â”‚
â”‚  â”‚ ]                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                              â”‚
â”‚  Emisiones (detalle_emision_gastos + emision_gastos_comunes)â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ [                                                       â”‚ â”‚
â”‚  â”‚   {                                                     â”‚ â”‚
â”‚  â”‚     emision_id: 1,                                      â”‚ â”‚
â”‚  â”‚     periodo: "2025-10",                                 â”‚ â”‚
â”‚  â”‚     monto_distribuido: 150000.00,                       â”‚ â”‚
â”‚  â”‚     estado: "emitido"                                   â”‚ â”‚
â”‚  â”‚   }                                                     â”‚ â”‚
â”‚  â”‚ ]                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Flujo de Seguridad

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MIDDLEWARE CHAIN                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  1. REQUEST                                                     â”‚
â”‚     â”‚                                                           â”‚
â”‚     â–¼                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  authenticate()                         â”‚                    â”‚
â”‚  â”‚  - Verify JWT token                    â”‚                    â”‚
â”‚  â”‚  - Decode user info                    â”‚                    â”‚
â”‚  â”‚  - Attach req.user                     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                 â”‚ âœ… Valid Token                                â”‚
â”‚                 â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  checkGastoPermission('action')        â”‚                    â”‚
â”‚  â”‚  - Check user role                     â”‚                    â”‚
â”‚  â”‚  - Check community membership          â”‚                    â”‚
â”‚  â”‚  - Validate permissions for action     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                 â”‚ âœ… Has Permission                             â”‚
â”‚                 â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  validationResult()                    â”‚                    â”‚
â”‚  â”‚  - Validate request body               â”‚                    â”‚
â”‚  â”‚  - Check required fields               â”‚                    â”‚
â”‚  â”‚  - Sanitize inputs                     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                 â”‚ âœ… Valid Data                                 â”‚
â”‚                 â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚  ROUTE HANDLER                         â”‚                    â”‚
â”‚  â”‚  - Process request                     â”‚                    â”‚
â”‚  â”‚  - Execute business logic              â”‚                    â”‚
â”‚  â”‚  - Return response                     â”‚                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Rejection Points:
âŒ Invalid Token â†’ 401 Unauthorized
âŒ No Permission â†’ 403 Forbidden
âŒ Invalid Data â†’ 400 Bad Request
```

---

## ğŸ“¦ Estructura de MÃ³dulos

```
ccbackend/src/
â”‚
â”œâ”€â”€ routes/
â”‚   â”œâ”€â”€ gastos.js â­ (19 endpoints)
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/comunidad/:id
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/:id
â”‚   â”‚   â”œâ”€â”€ POST   /gastos/comunidad/:id
â”‚   â”‚   â”œâ”€â”€ PUT    /gastos/:id
â”‚   â”‚   â”œâ”€â”€ DELETE /gastos/:id
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/comunidad/:id/stats
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/comunidad/:id/por-categoria
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/comunidad/:id/por-proveedor
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/comunidad/:id/por-centro-costo
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/comunidad/:id/evolucion-temporal
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/comunidad/:id/top-gastos
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/comunidad/:id/pendientes-aprobacion
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/comunidad/:id/alertas
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/:id/historial
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/:id/aprobaciones
â”‚   â”‚   â”œâ”€â”€ POST   /gastos/:id/aprobaciones
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/:id/archivos
â”‚   â”‚   â”œâ”€â”€ GET    /gastos/:id/emisiones
â”‚   â”‚   â””â”€â”€ POST   /gastos/:id/anular
â”‚   â”‚
â”‚   â””â”€â”€ gastos.swagger.js (OpenAPI Documentation)
â”‚
â”œâ”€â”€ middleware/
â”‚   â”œâ”€â”€ auth.js (authenticate)
â”‚   â””â”€â”€ gastosPermissions.js (checkGastoPermission)
â”‚
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ aprobaciones.js (requiredApprovalsForAmount)
â”‚
â””â”€â”€ db.js (MySQL connection pool)


ccfrontend/
â”‚
â”œâ”€â”€ pages/gastos/
â”‚   â”œâ”€â”€ index.tsx â­ (Listado)
â”‚   â”œâ”€â”€ nuevo.tsx â­ (Crear)
â”‚   â”œâ”€â”€ [id].tsx â­ (Detalle)
â”‚   â”œâ”€â”€ editar/[id].tsx â­ (Editar)
â”‚   â””â”€â”€ reportes.tsx â­ (Reportes - NUEVO)
â”‚
â”œâ”€â”€ lib/api/
â”‚   â””â”€â”€ gastos.ts â­ (21 funciones + 13 interfaces)
â”‚
â”œâ”€â”€ lib/adapters/
â”‚   â””â”€â”€ gastosAdapter.ts (Data transformation)
â”‚
â””â”€â”€ components/
    â”œâ”€â”€ layout/Layout.tsx
    â””â”€â”€ (otros componentes compartidos)
```

---

## ğŸ¯ Puntos de IntegraciÃ³n Clave

### 1. AutenticaciÃ³n
```typescript
// Frontend: lib/api/gastos.ts
const getAuthHeaders = () => {
  const token = localStorage.getItem('token');
  return {
    Authorization: `Bearer ${token}`
  };
};

// Backend: middleware/auth.js
const authenticate = (req, res, next) => {
  const token = req.headers.authorization?.split(' ')[1];
  // Verify token...
};
```

### 2. ValidaciÃ³n
```typescript
// Frontend: pages/gastos/nuevo.tsx
const validateForm = (): boolean => {
  const newErrors: Record<string, string> = {};
  if (!formData.glosa.trim()) {
    newErrors.glosa = 'La descripciÃ³n es obligatoria';
  }
  // More validations...
  return Object.keys(newErrors).length === 0;
};

// Backend: routes/gastos.js
body('glosa')
  .notEmpty()
  .isLength({ min: 3, max: 500 })
  .withMessage('Glosa debe tener entre 3 y 500 caracteres')
```

### 3. TransformaciÃ³n de Datos
```typescript
// Frontend: lib/adapters/gastosAdapter.ts
export const adaptGastoForDetail = (gasto: any) => {
  return {
    ...gasto,
    monto: parseFloat(gasto.monto || 0),
    extraordinario: !!gasto.extraordinario,
    fecha: new Date(gasto.fecha).toISOString().split('T')[0]
  };
};
```

---

## ğŸ“Š MÃ©tricas de Rendimiento

```
Endpoint Performance (promedio):
â”œâ”€â”€ GET  /gastos/comunidad/:id         â†’ 50-100ms
â”œâ”€â”€ GET  /gastos/:id                   â†’ 30-50ms
â”œâ”€â”€ POST /gastos/comunidad/:id         â†’ 100-150ms
â”œâ”€â”€ PUT  /gastos/:id                   â†’ 80-120ms
â”œâ”€â”€ DELETE /gastos/:id                 â†’ 40-60ms
â”œâ”€â”€ GET  /gastos/comunidad/:id/stats   â†’ 60-90ms
â”œâ”€â”€ GET  /gastos/.../por-categoria     â†’ 70-100ms
â”œâ”€â”€ GET  /gastos/.../por-proveedor     â†’ 80-110ms
â”œâ”€â”€ GET  /gastos/.../por-centro-costo  â†’ 70-100ms
â”œâ”€â”€ GET  /gastos/.../evolucion-temporalâ†’ 90-130ms
â”œâ”€â”€ GET  /gastos/.../top-gastos        â†’ 60-90ms
â”œâ”€â”€ GET  /gastos/.../pendientes...     â†’ 50-80ms
â”œâ”€â”€ GET  /gastos/.../alertas           â†’ 80-110ms
â”œâ”€â”€ GET  /gastos/:id/historial         â†’ 40-70ms
â”œâ”€â”€ GET  /gastos/:id/aprobaciones      â†’ 40-70ms
â”œâ”€â”€ POST /gastos/:id/aprobaciones      â†’ 100-150ms
â”œâ”€â”€ GET  /gastos/:id/archivos          â†’ 50-80ms
â”œâ”€â”€ GET  /gastos/:id/emisiones         â†’ 60-90ms
â””â”€â”€ POST /gastos/:id/anular            â†’ 90-130ms

Total average: 67ms
```

---

## ğŸ“ Patrones de DiseÃ±o Utilizados

### 1. **Repository Pattern**
```
DB Layer â† â†’ Routes/Controllers â† â†’ Frontend API Client
```

### 2. **Adapter Pattern**
```
Backend Data â†’ Adapter â†’ Frontend Data Model
```

### 3. **Middleware Chain Pattern**
```
Request â†’ Auth â†’ Permissions â†’ Validation â†’ Handler
```

### 4. **Promise.all Pattern**
```javascript
// Cargar mÃºltiples endpoints en paralelo
const [gastos, stats, alerts] = await Promise.all([
  gastosApi.listarGastos(),
  gastosApi.obtenerEstadisticas(),
  gastosApi.obtenerAlertas()
]);
```

---

**Ãšltima actualizaciÃ³n:** 13 de Octubre, 2025  
**VersiÃ³n:** 1.0  
**Estado:** âœ… PRODUCCIÃ“N
