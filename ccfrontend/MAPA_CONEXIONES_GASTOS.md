# ğŸ”— MAPA DE CONEXIONES - MÃ³dulo de Gastos

## ğŸ“Š Diagrama de Arquitectura General

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MÃ“DULO DE GASTOS                              â”‚
â”‚                   (Sistema de GestiÃ³n Completa)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                                       â”‚
        â–¼                                                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND    â”‚                                    â”‚     BACKEND      â”‚
â”‚  (Next.js)    â”‚â—„â”€â”€â”€â”€â”€â”€â”€ HTTP/REST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   (Express.js)   â”‚
â”‚               â”‚        JSON + JWT                  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                                       â”‚
        â”‚                                                       â”‚
        â”œâ”€ pages/gastos.tsx                                   â”œâ”€ routes/gastos.js
        â”œâ”€ pages/gastos/nuevo.tsx                             â”‚   (19 endpoints)
        â”œâ”€ pages/gastos/[id].tsx                              â”‚
        â”œâ”€ pages/gastos/reportes.tsx                          â–¼
        â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”œâ”€ lib/api/gastos.ts                        â”‚   MySQL 8.0.43   â”‚
        â”‚  (21 funciones API)                       â”‚   (Base de Datos)â”‚
        â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUARIO     â”‚
â”‚   (Browser)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—ºï¸ Mapa de Endpoints por PÃ¡gina

### **PÃGINA 1: `/gastos` (Listado Principal)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GASTOS.TSX - Listado Principal                        â”‚
â”‚                                                         â”‚
â”‚  Estado: âœ… 100% Funcional                             â”‚
â”‚  Endpoints: 2/2                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /gastos/    â”‚          â”‚ GET /gastos/     â”‚
â”‚ comunidad/:id   â”‚          â”‚ comunidad/:id/   â”‚
â”‚                 â”‚          â”‚ stats            â”‚
â”‚ LÃ­nea: 69-87    â”‚          â”‚                  â”‚
â”‚                 â”‚          â”‚ LÃ­nea: 89-99     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                              â”‚
        â–¼                              â–¼
   [Lista de      [EstadÃ­sticas:
    gastos]         - Total gastos
                    - Monto total
                    - Pendientes
                    - Aprobados]
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  UI COMPONENTS      â”‚
                    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                    â”‚ â€¢ Tabla (338-464)   â”‚
                    â”‚ â€¢ Tarjetas (473-548)â”‚
                    â”‚ â€¢ Stats (175-193)   â”‚
                    â”‚ â€¢ Filtros (228-305) â”‚
                    â”‚ â€¢ PaginaciÃ³n        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **PÃGINA 2: `/gastos/nuevo` (Crear Gasto)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  NUEVO.TSX - Crear Nuevo Gasto                         â”‚
â”‚                                                         â”‚
â”‚  Estado: âœ… 95% Funcional                              â”‚
â”‚  Endpoints: 2 (1 principal + 1 pendiente)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /gastos/   â”‚        â”‚ POST /gastos/:id/  â”‚
â”‚ comunidad/:id   â”‚        â”‚ archivos           â”‚
â”‚                 â”‚        â”‚                    â”‚
â”‚ LÃ­nea: 232-267  â”‚        â”‚ LÃ­nea: 252-258     â”‚
â”‚ âœ… Funcional    â”‚        â”‚ âš ï¸ Backend falta   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                             â”‚
        â–¼                             â–¼
   [Crea gasto]              [Sube archivos]
   [Retorna ID]              [Adjunta al gasto]
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FORMULARIO                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ DescripciÃ³n âœ…            â”‚
â”‚ â€¢ CategorÃ­a âœ…              â”‚
â”‚ â€¢ Proveedor âœ…              â”‚
â”‚ â€¢ Monto âœ…                  â”‚
â”‚ â€¢ Fecha âœ…                  â”‚
â”‚ â€¢ Tipo Documento âœ…         â”‚
â”‚ â€¢ NÃºmero Documento âœ…       â”‚
â”‚ â€¢ Centro Costo âšª           â”‚
â”‚ â€¢ Extraordinario âšª          â”‚
â”‚ â€¢ Tags âšª                    â”‚
â”‚ â€¢ Archivos âš ï¸               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VALIDACIONES               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ… Campos obligatorios      â”‚
â”‚ âœ… Monto > 0                â”‚
â”‚ âœ… Formato de fecha         â”‚
â”‚ âœ… Tipo de archivo          â”‚
â”‚ âœ… TamaÃ±o < 10MB            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **PÃGINA 3: `/gastos/[id]` (Detalle de Gasto)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [ID].TSX - Vista Detallada de Gasto                           â”‚
â”‚                                                                 â”‚
â”‚  Estado: âœ… 100% Funcional                                     â”‚
â”‚  Endpoints: 8/8 (MÃ¡s completo del mÃ³dulo)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚                       â”‚
        â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /gastos/ â”‚     â”‚ GET /gastos/:id/ â”‚    â”‚ GET /gastos/:id/ â”‚
â”‚ :id          â”‚     â”‚ historial        â”‚    â”‚ aprobaciones     â”‚
â”‚              â”‚     â”‚                  â”‚    â”‚                  â”‚
â”‚ LÃ­nea: 25-34 â”‚     â”‚ LÃ­nea: 26        â”‚    â”‚ LÃ­nea: 27        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚                       â”‚
        â–¼                       â–¼                       â–¼
   [Gasto base]         [Historial de           [Aprobaciones]
                         cambios]
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚                                 â”‚
        â–¼                       â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /gastos/ â”‚     â”‚ POST /gastos/    â”‚         â”‚ DELETE /gastos/  â”‚
â”‚ :id/archivos â”‚     â”‚ :id/aprobar      â”‚         â”‚ :id              â”‚
â”‚              â”‚     â”‚                  â”‚         â”‚                  â”‚
â”‚ LÃ­nea: 28    â”‚     â”‚ LÃ­nea: 131-171   â”‚         â”‚ LÃ­nea: 178-193   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                       â”‚                         â”‚
        â–¼                       â–¼                         â–¼
   [Archivos            [Aprobar/Rechazar]        [Eliminar gasto]
    adjuntos]
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                                â”‚
        â–¼                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /gastos/ â”‚              â”‚ POST /gastos/    â”‚
â”‚ :id/emisionesâ”‚              â”‚ :id/anular       â”‚
â”‚              â”‚              â”‚                  â”‚
â”‚ LÃ­nea: 29    â”‚              â”‚ LÃ­nea: 197-213   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                â”‚
        â–¼                                â–¼
   [Emisiones                    [Anular gasto]
    asociadas]
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UI SECTIONS                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“„ Header (263-338)                      â”‚
â”‚    â€¢ NÃºmero, estado, botones             â”‚
â”‚                                          â”‚
â”‚ ğŸ“Š Info Grid (345-372)                   â”‚
â”‚    â€¢ 2 columnas con datos clave          â”‚
â”‚                                          â”‚
â”‚ ğŸ“‹ Card Detalles (375-441)               â”‚
â”‚    â€¢ InformaciÃ³n completa                â”‚
â”‚                                          â”‚
â”‚ ğŸ“ Archivos (446-490)                    â”‚
â”‚    â€¢ Lista de adjuntos                   â”‚
â”‚                                          â”‚
â”‚ âœ… Aprobaciones (494-537)                â”‚
â”‚    â€¢ Historial de aprobaciones           â”‚
â”‚                                          â”‚
â”‚ ğŸ”„ Timeline Historial (544-586)          â”‚
â”‚    â€¢ Cambios cronolÃ³gicos                â”‚
â”‚                                          â”‚
â”‚ ğŸ“… Emisiones (589-626)                   â”‚
â”‚    â€¢ DistribuciÃ³n por periodo            â”‚
â”‚                                          â”‚
â”‚ ğŸª§ Sidebar (629-663)                     â”‚
â”‚    â€¢ Resumen sticky                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **PÃGINA 4: `/gastos/reportes` (Dashboard de Reportes)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  REPORTES.TSX - Dashboard de AnÃ¡lisis                          â”‚
â”‚                                                                 â”‚
â”‚  Estado: âœ… 100% Funcional                                     â”‚
â”‚  Endpoints: 8/8 (Dashboard mÃ¡s completo)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚                       â”‚
        â–¼                       â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /gastos/ â”‚     â”‚ GET /gastos/     â”‚    â”‚ GET /gastos/     â”‚
â”‚ comunidad/   â”‚     â”‚ comunidad/:id/   â”‚    â”‚ comunidad/:id/   â”‚
â”‚ :id/por-     â”‚     â”‚ por-proveedor    â”‚    â”‚ por-centro-costo â”‚
â”‚ categoria    â”‚     â”‚                  â”‚    â”‚                  â”‚
â”‚              â”‚     â”‚ LÃ­nea: 43        â”‚    â”‚ LÃ­nea: 44        â”‚
â”‚ LÃ­nea: 42    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                       â”‚
        â”‚                     â–¼                       â–¼
        â”‚              [Por Proveedor]         [Por Centro Costo]
        â–¼              â€¢ Nombre                â€¢ Nombre
   [Por CategorÃ­a]     â€¢ Total gastos         â€¢ Total gastos
   â€¢ Nombre            â€¢ Monto total          â€¢ Monto total
   â€¢ Total gastos      â€¢ Promedio
   â€¢ Monto total       â€¢ Ãšltimo gasto
   â€¢ Porcentaje
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚                                 â”‚
        â–¼                       â–¼                                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /gastos/ â”‚     â”‚ GET /gastos/     â”‚         â”‚ GET /gastos/     â”‚
â”‚ comunidad/   â”‚     â”‚ comunidad/:id/   â”‚         â”‚ comunidad/:id/   â”‚
â”‚ :id/evolucionâ”‚     â”‚ top-gastos       â”‚         â”‚ pendientes-      â”‚
â”‚ -temporal    â”‚     â”‚                  â”‚         â”‚ aprobacion       â”‚
â”‚              â”‚     â”‚ LÃ­nea: 46        â”‚         â”‚                  â”‚
â”‚ LÃ­nea: 45    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ LÃ­nea: 47        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                     â–¼                            â”‚
        â”‚              [Top N Gastos                       â–¼
        â–¼               Mayores]                    [Gastos Pendientes]
   [EvoluciÃ³n           â€¢ Configurable              â€¢ Destacados
    Temporal]           â€¢ Filtrable                 â€¢ Card warning
   â€¢ Por mes/aÃ±o        â€¢ Top 5-50
   â€¢ Total gastos
   â€¢ Monto total
   â€¢ Promedio
        â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚
        â–¼                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GET /gastos/ â”‚          â”‚ Filtros          â”‚
â”‚ comunidad/   â”‚          â”‚ Aplicados        â”‚
â”‚ :id/alertas  â”‚          â”‚                  â”‚
â”‚              â”‚          â”‚ â€¢ Fecha desde    â”‚
â”‚ LÃ­nea: 48    â”‚          â”‚ â€¢ Fecha hasta    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ â€¢ Meses (1-24)   â”‚
        â”‚                 â”‚ â€¢ LÃ­mite (5-50)  â”‚
        â–¼                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   [Alertas]
   â€¢ Sin aprobaciÃ³n
   â€¢ Monto alto
   â€¢ Vencidos
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  8 REPORTES DESPLEGADOS                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1ï¸âƒ£ Alertas (229-247)                     â”‚
â”‚    â€¢ Cards con iconos y colores          â”‚
â”‚                                          â”‚
â”‚ 2ï¸âƒ£ Pendientes AprobaciÃ³n (253-295)      â”‚
â”‚    â€¢ Tabla destacada                     â”‚
â”‚                                          â”‚
â”‚ 3ï¸âƒ£ Por CategorÃ­a (302-331)              â”‚
â”‚    â€¢ Tabla con porcentajes               â”‚
â”‚                                          â”‚
â”‚ 4ï¸âƒ£ Por Centro Costo (336-361)           â”‚
â”‚    â€¢ Tabla resumen                       â”‚
â”‚                                          â”‚
â”‚ 5ï¸âƒ£ Por Proveedor (368-395)              â”‚
â”‚    â€¢ Tabla con promedios                 â”‚
â”‚                                          â”‚
â”‚ 6ï¸âƒ£ EvoluciÃ³n Temporal (399-423)         â”‚
â”‚    â€¢ Tabla mes/aÃ±o                       â”‚
â”‚                                          â”‚
â”‚ 7ï¸âƒ£ Top Gastos (428-478)                 â”‚
â”‚    â€¢ Tabla con links                     â”‚
â”‚                                          â”‚
â”‚ 8ï¸âƒ£ EstadÃ­sticas (implÃ­cito)             â”‚
â”‚    â€¢ Dashboard metrics                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”Œ Diagrama de Flujo de Datos

### **FLUJO TÃPICO: Cargar Lista de Gastos**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   USUARIO   â”‚
â”‚   (Browser) â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Navega a /gastos
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  gastos.tsx      â”‚
â”‚  (PÃ¡gina React)  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. useEffect() se ejecuta
       â”‚    al cargar componente
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  loadExpenses()  â”‚
â”‚  (lÃ­nea 69-87)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Llama a API function
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  gastosApi.listarGastos()â”‚
â”‚  (lib/api/gastos.ts)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. axios.get() con token
       â”‚    Authorization: Bearer <JWT>
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend API             â”‚
â”‚  GET /gastos/comunidad/1 â”‚
â”‚  (routes/gastos.js)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. Query a MySQL
       â”‚    SELECT * FROM gastos...
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  MySQL Database          â”‚
â”‚  tabla: gastos           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 6. Retorna filas
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend procesa         â”‚
â”‚  â€¢ Joins con tablas      â”‚
â”‚  â€¢ Aplica filtros        â”‚
â”‚  â€¢ PaginaciÃ³n            â”‚
â”‚  â€¢ Formateo JSON         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 7. Response JSON
       â”‚    { success: true,
       â”‚      data: [...],
       â”‚      pagination: {...} }
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  gastosApi.listarGastos()â”‚
â”‚  Recibe response         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 8. Retorna response.data
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  loadExpenses()          â”‚
â”‚  setExpenses(data)       â”‚
â”‚  setTotalItems(total)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 9. React actualiza estado
       â”‚    useState hooks disparan
       â”‚    re-render
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  gastos.tsx re-renderiza â”‚
â”‚  â€¢ Map sobre expenses[]  â”‚
â”‚  â€¢ Genera <tr> por cada  â”‚
â”‚  â€¢ Aplica formateo       â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 10. DOM actualizado
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USUARIO ve la tabla     â”‚
â”‚  con datos actualizados  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â±ï¸ Tiempo total: ~200-500ms
```

---

## ğŸ” Diagrama de AutenticaciÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FLUJO DE AUTENTICACIÃ“N                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Login Page â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 1. Usuario ingresa credenciales
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /auth/     â”‚
â”‚  login           â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 2. Backend valida
       â”‚    y genera JWT
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  localStorage    â”‚
â”‚  .setItem(       â”‚
â”‚   'token',       â”‚
â”‚   jwt_token)     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 3. Token guardado
       â”‚    en navegador
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Todas las llamadas API  â”‚
â”‚  incluyen header:        â”‚
â”‚                          â”‚
â”‚  const getAuthHeaders =  â”‚
â”‚    () => {               â”‚
â”‚      const token =       â”‚
â”‚        localStorage      â”‚
â”‚        .getItem('token');â”‚
â”‚      return {            â”‚
â”‚        Authorization:    â”‚
â”‚        `Bearer ${token}` â”‚
â”‚      };                  â”‚
â”‚    };                    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 4. Cada request incluye
       â”‚    Authorization header
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend verificaâ”‚
â”‚  JWT middleware  â”‚
â”‚  â€¢ Valida firma  â”‚
â”‚  â€¢ Verifica exp  â”‚
â”‚  â€¢ Extrae user   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ 5. Si vÃ¡lido, procesa
       â”‚    Si no, 401 Unauthorized
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Protected Route â”‚
â”‚  Component       â”‚
â”‚  â€¢ Verifica auth â”‚
â”‚  â€¢ Redirecciona  â”‚
â”‚    si no autent. â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—‚ï¸ Estructura de Datos

### **Objeto Gasto (completo)**

```typescript
{
  // IdentificaciÃ³n
  id: 123,
  numero: "G2024-0123",
  
  // Relaciones
  comunidad_id: 1,
  categoria_id: 5,
  centro_costo_id: 3,
  documento_compra_id: null,
  creado_por: 10,
  aprobado_por: 12,
  
  // Datos principales
  fecha: "2024-01-15",
  monto: 150000.50,
  glosa: "Mantenimiento de ascensores",
  extraordinario: false,
  
  // Estado
  estado: "aprobado",
  
  // Timestamps
  created_at: "2024-01-15T10:30:00Z",
  updated_at: "2024-01-16T14:20:00Z",
  
  // Datos relacionados (joins)
  categoria_nombre: "Mantenimiento",
  centro_costo_nombre: "Ãreas Comunes",
  creado_por_nombre: "Juan PÃ©rez",
  aprobado_por_nombre: "MarÃ­a GonzÃ¡lez",
  
  // Arrays opcionales (en detalle)
  aprobaciones: [...],
  historial: [...],
  archivos: [...],
  emisiones: [...]
}
```

---

## ğŸ“Š Tabla de Conexiones Completa

| # | Endpoint | MÃ©todo | FunciÃ³n API | PÃ¡gina(s) | Estado |
|---|----------|--------|-------------|-----------|--------|
| 1 | `/gastos/comunidad/:id` | GET | `listarGastos()` | gastos.tsx | âœ… |
| 2 | `/gastos/comunidad/:id/stats` | GET | `obtenerEstadisticas()` | gastos.tsx | âœ… |
| 3 | `/gastos/comunidad/:id` | POST | `crearGasto()` | nuevo.tsx | âœ… |
| 4 | `/gastos/:id` | GET | `obtenerGasto()` | [id].tsx | âœ… |
| 5 | `/gastos/:id` | PUT | `actualizarGasto()` | âŒ | âš ï¸ |
| 6 | `/gastos/:id` | DELETE | `eliminarGasto()` | [id].tsx | âœ… |
| 7 | `/gastos/:id/aprobar` | POST | `registrarAprobacion()` | [id].tsx | âœ… |
| 8 | `/gastos/:id/anular` | POST | `anularGasto()` | [id].tsx | âœ… |
| 9 | `/gastos/:id/historial` | GET | `obtenerHistorial()` | [id].tsx | âœ… |
| 10 | `/gastos/:id/aprobaciones` | GET | `obtenerAprobaciones()` | [id].tsx | âœ… |
| 11 | `/gastos/:id/archivos` | GET | `obtenerArchivos()` | [id].tsx | âœ… |
| 12 | `/gastos/:id/archivos` | POST | `subirArchivo()` | nuevo.tsx | âš ï¸ |
| 13 | `/gastos/:id/archivos/:archivoId` | DELETE | `eliminarArchivo()` | âŒ | âš ï¸ |
| 14 | `/gastos/:id/emisiones` | GET | `obtenerEmisiones()` | [id].tsx | âœ… |
| 15 | `/gastos/comunidad/:id/por-categoria` | GET | `obtenerGastosPorCategoria()` | reportes.tsx | âœ… |
| 16 | `/gastos/comunidad/:id/por-proveedor` | GET | `obtenerGastosPorProveedor()` | reportes.tsx | âœ… |
| 17 | `/gastos/comunidad/:id/por-centro-costo` | GET | `obtenerGastosPorCentroCosto()` | reportes.tsx | âœ… |
| 18 | `/gastos/comunidad/:id/evolucion-temporal` | GET | `obtenerEvolucionTemporal()` | reportes.tsx | âœ… |
| 19 | `/gastos/comunidad/:id/top-gastos` | GET | `obtenerTopGastos()` | reportes.tsx | âœ… |
| 20 | `/gastos/comunidad/:id/pendientes-aprobacion` | GET | `obtenerGastosPendientes()` | reportes.tsx | âœ… |
| 21 | `/gastos/comunidad/:id/alertas` | GET | `obtenerAlertas()` | reportes.tsx | âœ… |

**Leyenda:**
- âœ… = Conectado y funcional
- âš ï¸ = Endpoint pendiente en backend o pÃ¡gina no creada
- âŒ = No implementado

---

## ğŸ¯ Cobertura Visual

```
  ENDPOINTS BACKEND (19)
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘  94.7%
  
  PÃGINAS FRONTEND (6)
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  83.3%
  
  DATOS DESPLEGADOS
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  100%
  
  VALIDACIONES
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  100%
```

---

**Ãšltima actualizaciÃ³n:** 13 de octubre de 2025
